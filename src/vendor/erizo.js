/*
 Socket.IO.js build:0.9.6, development. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */
var swfobject;
(function(b,a){b.version="0.9.6";b.protocol=1;b.transports=[];b.j=[];b.sockets={};b.connect=function(e,d){e=b.util.parseUri(e);a&&a.location&&(e.protocol=e.protocol||a.location.protocol.slice(0,-1),e.host=e.host||(a.document?a.document.domain:a.location.hostname),e.port=e.port||a.location.port);var c=b.util.uniqueUri(e);var h={host:e.host,secure:"https"==e.protocol,port:e.port||("https"==e.protocol?443:80),query:e.query||""};b.util.merge(h,d);if(h["force new connection"]||!b.sockets[c])var k=new b.Socket(h);
!h["force new connection"]&&k&&(b.sockets[c]=k);k=k||b.sockets[c];return k.of(1<e.path.length?e.path:"")}})("object"===typeof module?module.exports:this.io={},this);
(function(b,a){var e=b.util={},d=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");e.parseUri=function(a){a=d.exec(a||"");for(var b={},f=14;f--;)b[c[f]]=a[f]||"";return b};e.uniqueUri=function(b){var c=b.protocol,f=b.host;b=b.port;"document"in
a?(f=f||document.domain,b=b||("https"==c&&"https:"!==document.location.protocol?443:document.location.port)):(f=f||"localhost",b||"https"!=c||(b=443));return(c||"http")+"://"+f+":"+(b||80)};e.query=function(a,b){a=e.chunkQuery(a||"");var f=[];e.merge(a,e.chunkQuery(b||""));for(var c in a)a.hasOwnProperty(c)&&f.push(c+"\x3d"+a[c]);return f.length?"?"+f.join("\x26"):""};e.chunkQuery=function(a){var b={};a=a.split("\x26");for(var f=0,c=a.length,d;f<c;++f)d=a[f].split("\x3d"),d[0]&&(b[d[0]]=d[1]);return b};
var h=!1;e.load=function(b){if("document"in a&&"complete"===document.readyState||h)return b();e.on(a,"load",b,!1)};e.on=function(a,b,f,c){a.attachEvent?a.attachEvent("on"+b,f):a.addEventListener&&a.addEventListener(b,f,c)};e.request=function(a){if(a&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||e.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new (window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(l){}return null};
"undefined"!=typeof window&&e.load(function(){h=!0});e.defer=function(a){if(!e.ua.webkit||"undefined"!=typeof importScripts)return a();e.load(function(){setTimeout(a,100)})};e.merge=function(a,b,f,c){c=c||[];f="undefined"==typeof f?2:f;for(var g in b)b.hasOwnProperty(g)&&0>e.indexOf(c,g)&&("object"===typeof a[g]&&f?e.merge(a[g],b[g],f-1,c):(a[g]=b[g],c.push(b[g])));return a};e.mixin=function(a,b){e.merge(a.prototype,b.prototype)};e.inherit=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=
new c};e.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};e.intersect=function(a,b){var c=[],g=a.length>b.length?a:b;a=a.length>b.length?b:a;b=0;for(var d=a.length;b<d;b++)~e.indexOf(g,a[b])&&c.push(a[b]);return c};e.indexOf=function(a,b,c){var f=a.length;for(c=0>c?0>c+f?0:c+f:c||0;c<f&&a[c]!==b;c++);return f<=c?-1:c};e.toArray=function(a){for(var b=[],c=0,g=a.length;c<g;c++)b.push(a[c]);return b};e.ua={};e.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&
function(){try{var a=new XMLHttpRequest}catch(l){return!1}return void 0!=a.withCredentials}();e.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)})("undefined"!=typeof io?io:module.exports,this);
(function(b,a){function e(){}b.EventEmitter=e;e.prototype.on=function(b,c){this.$events||(this.$events={});this.$events[b]?a.util.isArray(this.$events[b])?this.$events[b].push(c):this.$events[b]=[this.$events[b],c]:this.$events[b]=c;return this};e.prototype.addListener=e.prototype.on;e.prototype.once=function(a,b){function c(){d.removeListener(a,c);b.apply(this,arguments)}var d=this;c.listener=b;this.on(a,c);return this};e.prototype.removeListener=function(b,c){if(this.$events&&this.$events[b]){var d=
this.$events[b];if(a.util.isArray(d)){for(var e=-1,l=0,f=d.length;l<f;l++)if(d[l]===c||d[l].listener&&d[l].listener===c){e=l;break}if(0>e)return this;d.splice(e,1);d.length||delete this.$events[b]}else(d===c||d.listener&&d.listener===c)&&delete this.$events[b]}return this};e.prototype.removeAllListeners=function(a){this.$events&&this.$events[a]&&(this.$events[a]=null);return this};e.prototype.listeners=function(b){this.$events||(this.$events={});this.$events[b]||(this.$events[b]=[]);a.util.isArray(this.$events[b])||
(this.$events[b]=[this.$events[b]]);return this.$events[b]};e.prototype.emit=function(b){if(!this.$events)return!1;var c=this.$events[b];if(!c)return!1;var d=Array.prototype.slice.call(arguments,1);if("function"==typeof c)c.apply(this,d);else if(a.util.isArray(c))for(var c=c.slice(),e=0,l=c.length;e<l;e++)c[e].apply(this,d);else return!1;return!0}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(b,a){function e(a){return 10>a?"0"+a:a}function d(a){k.lastIndex=0;return k.test(a)?'"'+a.replace(k,function(a){var b=g[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,b){var m=l,g=b[a];g instanceof Date&&(g=isFinite(a.valueOf())?a.getUTCFullYear()+"-"+e(a.getUTCMonth()+1)+"-"+e(a.getUTCDate())+"T"+e(a.getUTCHours())+":"+e(a.getUTCMinutes())+":"+e(a.getUTCSeconds())+"Z":null);"function"===typeof p&&(g=p.call(b,a,g));switch(typeof g){case "string":return d(g);
case "number":return isFinite(g)?String(g):"null";case "boolean":case "null":return String(g);case "object":if(!g)return"null";l+=f;var n=[];if("[object Array]"===Object.prototype.toString.apply(g)){var h=g.length;for(a=0;a<h;a+=1)n[a]=c(a,g)||"null";b=0===n.length?"[]":l?"[\n"+l+n.join(",\n"+l)+"\n"+m+"]":"["+n.join(",")+"]";l=m;return b}if(p&&"object"===typeof p)for(h=p.length,a=0;a<h;a+=1){if("string"===typeof p[a]){var k=p[a];(b=c(k,g))&&n.push(d(k)+(l?": ":":")+b)}}else for(k in g)Object.prototype.hasOwnProperty.call(g,
k)&&(b=c(k,g))&&n.push(d(k)+(l?": ":":")+b);b=0===n.length?"{}":l?"{\n"+l+n.join(",\n"+l)+"\n"+m+"}":"{"+n.join(",")+"}";l=m;return b}}if(a&&a.parse)return b.JSON={parse:a.parse,stringify:a.stringify};b=b.JSON={};var h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l,f,g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f",
"\r":"\\r",'"':'\\"',"\\":"\\\\"},p;b.stringify=function(a,b,g){var m;f=l="";if("number"===typeof g)for(m=0;m<g;m+=1)f+=" ";else"string"===typeof g&&(f=g);if((p=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",{"":a})};b.parse=function(a,b){function c(a,f){var m,g=a[f];if(g&&"object"===typeof g)for(m in g)if(Object.prototype.hasOwnProperty.call(g,m)){var d=c(g,m);void 0!==d?g[m]=d:delete g[m]}return b.call(a,f,g)}a=String(a);h.lastIndex=
0;h.test(a)&&(a=a.replace(h,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return a=eval("("+a+")"),"function"===typeof b?c({"":a},""):a;throw new SyntaxError("JSON.parse");}})("undefined"!=typeof io?io:module.exports,"undefined"!==typeof JSON?JSON:void 0);
(function(b,a){var e=b.parser={},d=e.packets="disconnect connect heartbeat message json event ack error noop".split(" "),c=e.reasons=["transport not supported","client not handshaken","unauthorized"],h=e.advice=["reconnect"],k=a.JSON,l=a.util.indexOf;e.encodePacket=function(a){var b=l(d,a.type),f=a.id||"",m=a.endpoint||"",g=a.ack,e=null;switch(a.type){case "error":var w=a.reason?l(c,a.reason):"";a=a.advice?l(h,a.advice):"";if(""!==w||""!==a)e=w+(""!==a?"+"+a:"");break;case "message":""!==a.data&&
(e=a.data);break;case "event":e={name:a.name};a.args&&a.args.length&&(e.args=a.args);e=k.stringify(e);break;case "json":e=k.stringify(a.data);break;case "connect":a.qs&&(e=a.qs);break;case "ack":e=a.ackId+(a.args&&a.args.length?"+"+k.stringify(a.args):"")}b=[b,f+("data"==g?"+":""),m];null!==e&&void 0!==e&&b.push(e);return b.join(":")};e.encodePayload=function(a){var b="";if(1==a.length)return a[0];for(var c=0,f=a.length;c<f;c++)b+="\ufffd"+a[c].length+"\ufffd"+a[c];return b};var f=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;
e.decodePacket=function(a){var b=a.match(f);if(!b)return{};var g=b[2]||"";a=b[5]||"";var m={type:d[b[1]],endpoint:b[4]||""};g&&(m.id=g,m.ack=b[3]?"data":!0);switch(m.type){case "error":b=a.split("+");m.reason=c[b[0]]||"";m.advice=h[b[1]]||"";break;case "message":m.data=a||"";break;case "event":try{var e=k.parse(a);m.name=e.name;m.args=e.args}catch(z){}m.args=m.args||[];break;case "json":try{m.data=k.parse(a)}catch(z){}break;case "connect":m.qs=a||"";break;case "ack":if(b=a.match(/^([0-9]+)(\+)?(.*)/))if(m.ackId=
b[1],m.args=[],b[3])try{m.args=b[3]?k.parse(b[3]):[]}catch(z){}}return m};e.decodePayload=function(a){if("\ufffd"==a.charAt(0)){for(var b=[],c=1,f="";c<a.length;c++)"\ufffd"==a.charAt(c)?(b.push(e.decodePacket(a.substr(c+1).substr(0,f))),c+=Number(f)+1,f=""):f+=a.charAt(c);return b}return[e.decodePacket(a)]}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(b,a){function e(a,b){this.socket=a;this.sessid=b}b.Transport=e;a.util.mixin(e,a.EventEmitter);e.prototype.onData=function(b){this.clearCloseTimeout();(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(""!==b&&(b=a.parser.decodePayload(b))&&b.length)for(var c=0,d=b.length;c<d;c++)this.onPacket(b[c]);return this};e.prototype.onPacket=function(a){this.socket.setHeartbeatTimeout();if("heartbeat"==a.type)return this.onHeartbeat();if("connect"==
a.type&&""==a.endpoint)this.onConnect();"error"==a.type&&"reconnect"==a.advice&&(this.open=!1);this.socket.onPacket(a);return this};e.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}};e.prototype.onDisconnect=function(){this.close&&this.open&&this.close();this.clearTimeouts();this.socket.onDisconnect();return this};e.prototype.onConnect=function(){this.socket.onConnect();return this};e.prototype.clearCloseTimeout=
function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)};e.prototype.clearTimeouts=function(){this.clearCloseTimeout();this.reopenTimeout&&clearTimeout(this.reopenTimeout)};e.prototype.packet=function(b){this.send(a.parser.encodePacket(b))};e.prototype.onHeartbeat=function(a){this.packet({type:"heartbeat"})};e.prototype.onOpen=function(){this.open=!0;this.clearCloseTimeout();this.socket.onOpen()};e.prototype.onClose=function(){this.open=!1;this.socket.onClose();this.onDisconnect()};
e.prototype.prepareUrl=function(){var b=this.socket.options;return this.scheme()+"://"+b.host+":"+b.port+"/"+b.resource+"/"+a.protocol+"/"+this.name+"/"+this.sessid};e.prototype.ready=function(a,b){b.call(this)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(b,a,e){function d(b){this.options={port:80,secure:!1,document:"document"in e?document:!1,resource:"socket.io",transports:a.transports,"connect timeout":1E4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3E3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843};a.util.merge(this.options,b);this.reconnecting=this.connecting=this.open=this.connected=!1;this.namespaces={};this.buffer=
[];this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||a.util.ua.hasCORS)){var c=this;a.util.on(e,"unload",function(){c.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function c(){}b.Socket=d;a.util.mixin(d,a.EventEmitter);d.prototype.of=function(b){this.namespaces[b]||(this.namespaces[b]=new a.SocketNamespace(this,b),""!==b&&this.namespaces[b].packet({type:"connect"}));return this.namespaces[b]};d.prototype.publish=function(){this.emit.apply(this,
arguments);var a;for(a in this.namespaces)if(this.namespaces.hasOwnProperty(a)){var b=this.of(a);b.$emit.apply(b,arguments)}};d.prototype.handshake=function(b){function d(a){if(a instanceof Error)e.onError(a.message);else b.apply(null,a.split(":"))}var e=this,f=this.options,f=["http"+(f.secure?"s":"")+":/",f.host+":"+f.port,f.resource,a.protocol,a.util.query(this.options.query,"t\x3d"+ +new Date)].join("/");if(this.isXDomain()&&!a.util.ua.hasCORS){var g=document.getElementsByTagName("script")[0],
h=document.createElement("script");h.src=f+"\x26jsonp\x3d"+a.j.length;g.parentNode.insertBefore(h,g);a.j.push(function(a){d(a);h.parentNode.removeChild(h)})}else{var n=a.util.request();n.open("GET",f,!0);n.withCredentials=!0;n.onreadystatechange=function(){4==n.readyState&&(n.onreadystatechange=c,200==n.status?d(n.responseText):!e.reconnecting&&e.onError(n.responseText))};n.send(null)}};d.prototype.getTransport=function(b){b=b||this.transports;for(var c=0,d;d=b[c];c++)if(a.Transport[d]&&a.Transport[d].check(this)&&
(!this.isXDomain()||a.Transport[d].xdomainCheck()))return new a.Transport[d](this,this.sessionid);return null};d.prototype.connect=function(b){if(this.connecting)return this;var c=this;this.handshake(function(d,f,g,e){function n(a){c.transport&&c.transport.clearTimeouts();c.transport=c.getTransport(a);if(!c.transport)return c.publish("connect_failed");c.transport.ready(c,function(){c.connecting=!0;c.publish("connecting",c.transport.name);c.transport.open();c.options["connect timeout"]&&(c.connectTimeoutTimer=
setTimeout(function(){if(!c.connected&&(c.connecting=!1,c.options["try multiple transports"])){c.remainingTransports||(c.remainingTransports=c.transports.slice(0));for(var a=c.remainingTransports;0<a.length&&a.splice(0,1)[0]!=c.transport.name;);a.length?n(a):c.publish("connect_failed")}},c.options["connect timeout"]))})}c.sessionid=d;c.closeTimeout=1E3*g;c.heartbeatTimeout=1E3*f;c.transports=e?a.util.intersect(e.split(","),c.options.transports):c.options.transports;c.setHeartbeatTimeout();n(c.transports);
c.once("connect",function(){clearTimeout(c.connectTimeoutTimer);b&&"function"==typeof b&&b()})});return this};d.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)};d.prototype.packet=function(a){this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a);return this};d.prototype.setBuffer=function(a){this.doBuffer=a;!a&&this.connected&&this.buffer.length&&
(this.transport.payload(this.buffer),this.buffer=[])};d.prototype.disconnect=function(){if(this.connected||this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this};d.prototype.disconnectSync=function(){a.util.request().open("GET",this.resource+"/"+a.protocol+"/"+this.sessionid,!0);this.onDisconnect("booted")};d.prototype.isXDomain=function(){var a=e.location.port||("https:"==e.location.protocol?443:80);return this.options.host!==e.location.hostname||
this.options.port!=a};d.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))};d.prototype.onOpen=function(){this.open=!0};d.prototype.onClose=function(){this.open=!1;clearTimeout(this.heartbeatTimeoutTimer)};d.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)};d.prototype.onError=function(a){a&&a.advice&&"reconnect"===a.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&
this.reconnect());this.publish("error",a&&a.reason?a.reason:a)};d.prototype.onDisconnect=function(a){var b=this.connected,c=this.connecting;this.open=this.connecting=this.connected=!1;if(b||c)this.transport.close(),this.transport.clearTimeouts(),b&&(this.publish("disconnect",a),"booted"!=a&&this.options.reconnect&&!this.reconnecting&&this.reconnect())};d.prototype.reconnect=function(){function a(){if(c.connected){for(var a in c.namespaces)c.namespaces.hasOwnProperty(a)&&""!==a&&c.namespaces[a].packet({type:"connect"});
c.publish("reconnect",c.transport.name,c.reconnectionAttempts)}clearTimeout(c.reconnectionTimer);c.removeListener("connect_failed",b);c.removeListener("connect",b);c.reconnecting=!1;delete c.reconnectionAttempts;delete c.reconnectionDelay;delete c.reconnectionTimer;delete c.redoTransports;c.options["try multiple transports"]=g}function b(){if(c.reconnecting){if(c.connected)return a();if(c.connecting&&c.reconnecting)return c.reconnectionTimer=setTimeout(b,1E3);c.reconnectionAttempts++>=f?c.redoTransports?
(c.publish("reconnect_failed"),a()):(c.on("connect_failed",b),c.options["try multiple transports"]=!0,c.transport=c.getTransport(),c.redoTransports=!0,c.connect()):(c.reconnectionDelay<d&&(c.reconnectionDelay*=2),c.connect(),c.publish("reconnecting",c.reconnectionDelay,c.reconnectionAttempts),c.reconnectionTimer=setTimeout(b,c.reconnectionDelay))}}this.reconnecting=!0;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var c=this,f=this.options["max reconnection attempts"],
g=this.options["try multiple transports"],d=this.options["reconnection limit"];this.options["try multiple transports"]=!1;this.reconnectionTimer=setTimeout(b,this.reconnectionDelay);this.on("connect",b)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(b,a){function e(a,b){this.socket=a;this.name=b||"";this.flags={};this.json=new d(this,"json");this.ackPackets=0;this.acks={}}function d(a,b){this.namespace=a;this.name=b}b.SocketNamespace=e;a.util.mixin(e,a.EventEmitter);e.prototype.$emit=a.EventEmitter.prototype.emit;e.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};e.prototype.packet=function(a){a.endpoint=this.name;this.socket.packet(a);this.flags={};return this};e.prototype.send=function(a,b){a={type:this.flags.json?
"json":"message",data:a};"function"==typeof b&&(a.id=++this.ackPackets,a.ack=!0,this.acks[a.id]=b);return this.packet(a)};e.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d={type:"event",name:a};"function"==typeof c&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=c,b=b.slice(0,b.length-1));d.args=b;return this.packet(d)};e.prototype.disconnect=function(){""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect"));
return this};e.prototype.onPacket=function(b){function c(){d.packet({type:"ack",args:a.util.toArray(arguments),ackId:b.id})}var d=this;switch(b.type){case "connect":this.$emit("connect");break;case "disconnect":if(""===this.name)this.socket.onDisconnect(b.reason||"booted");else this.$emit("disconnect",b.reason);break;case "message":case "json":var e=["message",b.data];"data"==b.ack?e.push(c):b.ack&&this.packet({type:"ack",ackId:b.id});this.$emit.apply(this,e);break;case "event":e=[b.name].concat(b.args);
"data"==b.ack&&e.push(c);this.$emit.apply(this,e);break;case "ack":this.acks[b.ackId]&&(this.acks[b.ackId].apply(this,b.args),delete this.acks[b.ackId]);break;case "error":if(b.advice)this.socket.onError(b);else"unauthorized"==b.reason?this.$emit("connect_failed",b.reason):this.$emit("error",b.reason)}};d.prototype.send=function(){this.namespace.flags[this.name]=!0;this.namespace.send.apply(this.namespace,arguments)};d.prototype.emit=function(){this.namespace.flags[this.name]=!0;this.namespace.emit.apply(this.namespace,
arguments)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(b,a,e){function d(b){a.Transport.apply(this,arguments)}b.websocket=d;a.util.inherit(d,a.Transport);d.prototype.name="websocket";d.prototype.open=function(){var b=a.util.query(this.socket.options.query),d=this,k;k||(k=e.MozWebSocket||e.WebSocket);this.websocket=new k(this.prepareUrl()+b);this.websocket.onopen=function(){d.onOpen();d.socket.setBuffer(!1)};this.websocket.onmessage=function(a){d.onData(a.data)};this.websocket.onclose=function(){d.onClose();d.socket.setBuffer(!0)};this.websocket.onerror=
function(a){d.onError(a)};return this};d.prototype.send=function(a){this.websocket.send(a);return this};d.prototype.payload=function(a){for(var b=0,c=a.length;b<c;b++)this.packet(a[b]);return this};d.prototype.close=function(){this.websocket.close();return this};d.prototype.onError=function(a){this.socket.onError(a)};d.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};d.check=function(){return"WebSocket"in e&&!("__addTask"in WebSocket)||"MozWebSocket"in e};d.xdomainCheck=function(){return!0};
a.transports.push("websocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(b,a){function e(){a.Transport.websocket.apply(this,arguments)}b.flashsocket=e;a.util.inherit(e,a.Transport.websocket);e.prototype.name="flashsocket";e.prototype.open=function(){var b=this,c=arguments;WebSocket.__addTask(function(){a.Transport.websocket.prototype.open.apply(b,c)});return this};e.prototype.send=function(){var b=this,c=arguments;WebSocket.__addTask(function(){a.Transport.websocket.prototype.send.apply(b,c)});return this};e.prototype.close=function(){WebSocket.__tasks.length=
0;a.Transport.websocket.prototype.close.call(this);return this};e.prototype.ready=function(b,c){function d(){var a=b.options,f=a["flash policy port"],g=["http"+(a.secure?"s":"")+":/",a.host+":"+a.port,a.resource,"static/flashsocket","WebSocketMain"+(b.isXDomain()?"Insecure":"")+".swf"];e.loaded||("undefined"===typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=g.join("/")),843!==f&&WebSocket.loadFlashPolicyFile("xmlsocket://"+a.host+":"+f),WebSocket.__initialize(),e.loaded=!0);c.call(k)}var k=
this;if(document.body)return d();a.util.load(d)};e.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject?10<=swfobject.getFlashPlayerVersion().major:!1};e.xdomainCheck=function(){return!0};"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0);a.transports.push("flashsocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);
"undefined"!=typeof window&&(swfobject=function(){function b(){if(!D){try{var a=r.getElementsByTagName("body")[0].appendChild(r.createElement("span"));a.parentNode.removeChild(a)}catch(P){return}D=!0;for(var a=u.length,b=0;b<a;b++)u[b]()}}function a(a){D?a():u[u.length]=a}function e(a){if("undefined"!=typeof v.addEventListener)v.addEventListener("load",a,!1);else if("undefined"!=typeof r.addEventListener)r.addEventListener("load",a,!1);else if("undefined"!=typeof v.attachEvent)x(v,"onload",a);else if("function"==
typeof v.onload){var b=v.onload;v.onload=function(){b();a()}}else v.onload=a}function d(){var a=r.getElementsByTagName("body")[0],b=r.createElement("object");b.setAttribute("type","application/x-shockwave-flash");var f=a.appendChild(b);if(f){var m=0;(function(){if("undefined"!=typeof f.GetVariable){var g=f.GetVariable("$version");g&&(g=g.split(" ")[1].split(","),q.pv=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)])}else if(10>m){m++;setTimeout(arguments.callee,10);return}a.removeChild(b);
f=null;c()})()}else c()}function c(){var a=y.length;if(0<a)for(var b=0;b<a;b++){var c=y[b].id,g=y[b].callbackFn,d={success:!1,id:c};if(0<q.pv[0]){var e=m(c);if(e)if(!z(y[b].swfVersion)||q.wk&&312>q.wk)if(y[b].expressInstall&&k()){d={};d.data=y[b].expressInstall;d.width=e.getAttribute("width")||"0";d.height=e.getAttribute("height")||"0";e.getAttribute("class")&&(d.styleclass=e.getAttribute("class"));e.getAttribute("align")&&(d.align=e.getAttribute("align"));for(var n={},e=e.getElementsByTagName("param"),
x=e.length,p=0;p<x;p++)"movie"!=e[p].getAttribute("name").toLowerCase()&&(n[e[p].getAttribute("name")]=e[p].getAttribute("value"));l(d,n,c,g)}else f(e),g&&g(d);else C(c,!0),g&&(d.success=!0,d.ref=h(c),g(d))}else C(c,!0),g&&((c=h(c))&&"undefined"!=typeof c.SetVariable&&(d.success=!0,d.ref=c),g(d))}}function h(a){var b=null;(a=m(a))&&"OBJECT"==a.nodeName&&("undefined"!=typeof a.SetVariable?b=a:(a=a.getElementsByTagName("object")[0])&&(b=a));return b}function k(){return!I&&z("6.0.65")&&(q.win||q.mac)&&
!(q.wk&&312>q.wk)}function l(a,b,c,f){I=!0;K=f||null;N={success:!1,id:c};var d=m(c);if(d){"OBJECT"==d.nodeName?(H=g(d),J=null):(H=d,J=c);a.id="SWFObjectExprInst";if("undefined"==typeof a.width||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if("undefined"==typeof a.height||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";r.title=r.title.slice(0,47)+" - Flash Player Installation";f=q.ie&&q.win?["Active"].concat("").join("X"):"PlugIn";f="MMredirectURL\x3d"+v.location.toString().replace(/&/g,
"%26")+"\x26MMplayerType\x3d"+f+"\x26MMdoctitle\x3d"+r.title;b.flashvars="undefined"!=typeof b.flashvars?b.flashvars+("\x26"+f):f;q.ie&&q.win&&4!=d.readyState&&(f=r.createElement("div"),c+="SWFObjectNew",f.setAttribute("id",c),d.parentNode.insertBefore(f,d),d.style.display="none",function(){4==d.readyState?d.parentNode.removeChild(d):setTimeout(arguments.callee,10)}());p(a,b,c)}}function f(a){if(q.ie&&q.win&&4!=a.readyState){var b=r.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(g(a),
b);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(g(a),a)}function g(a){var b=r.createElement("div");if(q.win&&q.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName("object")[0])if(a=a.childNodes)for(var c=a.length,f=0;f<c;f++)1==a[f].nodeType&&"PARAM"==a[f].nodeName||8==a[f].nodeType||b.appendChild(a[f].cloneNode(!0));return b}function p(a,b,c){var f=m(c);if(q.wk&&312>q.wk)return n;if(f)if("undefined"==
typeof a.id&&(a.id=c),q.ie&&q.win){var g="";for(d in a)a[d]!=Object.prototype[d]&&("data"==d.toLowerCase()?b.movie=a[d]:"styleclass"==d.toLowerCase()?g+=' class\x3d"'+a[d]+'"':"classid"!=d.toLowerCase()&&(g+=" "+d+'\x3d"'+a[d]+'"'));var d="";for(var e in b)b[e]!=Object.prototype[e]&&(d+='\x3cparam name\x3d"'+e+'" value\x3d"'+b[e]+'" /\x3e');f.outerHTML='\x3cobject classid\x3d"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+g+"\x3e"+d+"\x3c/object\x3e";E[E.length]=a.id;var n=m(a.id)}else{e=r.createElement("object");
e.setAttribute("type","application/x-shockwave-flash");for(var h in a)a[h]!=Object.prototype[h]&&("styleclass"==h.toLowerCase()?e.setAttribute("class",a[h]):"classid"!=h.toLowerCase()&&e.setAttribute(h,a[h]));for(g in b)b[g]!=Object.prototype[g]&&"movie"!=g.toLowerCase()&&(a=e,d=g,h=b[g],c=r.createElement("param"),c.setAttribute("name",d),c.setAttribute("value",h),a.appendChild(c));f.parentNode.replaceChild(e,f);n=e}return n}function n(a){var b=m(a);b&&"OBJECT"==b.nodeName&&(q.ie&&q.win?(b.style.display=
"none",function(){if(4==b.readyState){var c=m(a);if(c){for(var f in c)"function"==typeof c[f]&&(c[f]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function m(a){var b=null;try{b=r.getElementById(a)}catch(P){}return b}function x(a,b,c){a.attachEvent(b,c);F[F.length]=[a,b,c]}function z(a){var b=q.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&
b[1]==a[1]&&b[2]>=a[2]?!0:!1}function w(a,b,c,f){if(!q.ie||!q.mac){var m=r.getElementsByTagName("head")[0];m&&(c=c&&"string"==typeof c?c:"screen",f&&(M=A=null),A&&M==c||(f=r.createElement("style"),f.setAttribute("type","text/css"),f.setAttribute("media",c),A=m.appendChild(f),q.ie&&q.win&&"undefined"!=typeof r.styleSheets&&0<r.styleSheets.length&&(A=r.styleSheets[r.styleSheets.length-1]),M=c),q.ie&&q.win?A&&"object"==typeof A.addRule&&A.addRule(a,b):A&&"undefined"!=typeof r.createTextNode&&A.appendChild(r.createTextNode(a+
" {"+b+"}")))}}function C(a,b){O&&(b=b?"visible":"hidden",D&&m(a)?m(a).style.visibility=b:w("#"+a,"visibility:"+b))}function G(a){return null!=/[\\\"<>\.;]/.exec(a)&&"undefined"!=typeof encodeURIComponent?encodeURIComponent(a):a}var v=window,r=document,t=navigator,B=!1,u=[function(){B?d():c()}],y=[],E=[],F=[],H,J,K,N,D=!1,I=!1,A,M,O=!0,q=function(){var a="undefined"!=typeof r.getElementById&&"undefined"!=typeof r.getElementsByTagName&&"undefined"!=typeof r.createElement,b=t.userAgent.toLowerCase(),
c=t.platform.toLowerCase(),f=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,m=!+"\v1",g=[0,0,0],d=null;if("undefined"!=typeof t.plugins&&"object"==typeof t.plugins["Shockwave Flash"])!(d=t.plugins["Shockwave Flash"].description)||"undefined"!=typeof t.mimeTypes&&t.mimeTypes["application/x-shockwave-flash"]&&!t.mimeTypes["application/x-shockwave-flash"].enabledPlugin||(B=!0,m=!1,d=d.replace(/^.*\s+(\S+\s+\S+$)/,
"$1"),g[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10),g[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10),g[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if("undefined"!=typeof v[["Active"].concat("Object").join("X")])try{if(d=(new (window[["Active"].concat("Object").join("X")])("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version"))m=!0,d=d.split(" ")[1].split(","),g=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]}catch(R){}return{w3:a,pv:g,wk:b,ie:m,win:f,
mac:c}}();(function(){q.w3&&(("undefined"!=typeof r.readyState&&"complete"==r.readyState||"undefined"==typeof r.readyState&&(r.getElementsByTagName("body")[0]||r.body))&&b(),D||("undefined"!=typeof r.addEventListener&&r.addEventListener("DOMContentLoaded",b,!1),q.ie&&q.win&&(r.attachEvent("onreadystatechange",function(){"complete"==r.readyState&&(r.detachEvent("onreadystatechange",arguments.callee),b())}),v==top&&function(){if(!D){try{r.documentElement.doScroll("left")}catch(Q){setTimeout(arguments.callee,
0);return}b()}}()),q.wk&&function(){D||(/loaded|complete/.test(r.readyState)?b():setTimeout(arguments.callee,0))}(),e(b)))})();(function(){q.ie&&q.win&&window.attachEvent("onunload",function(){for(var a=F.length,b=0;b<a;b++)F[b][0].detachEvent(F[b][1],F[b][2]);a=E.length;for(b=0;b<a;b++)n(E[b]);for(var c in q)q[c]=null;q=null;for(var f in swfobject)swfobject[f]=null;swfobject=null})})();return{registerObject:function(a,b,c,f){if(q.w3&&a&&b){var m={};m.id=a;m.swfVersion=b;m.expressInstall=c;m.callbackFn=
f;y[y.length]=m;C(a,!1)}else f&&f({success:!1,id:a})},getObjectById:function(a){if(q.w3)return h(a)},embedSWF:function(b,c,f,m,d,g,e,n,h,x){var w={success:!1,id:c};q.w3&&!(q.wk&&312>q.wk)&&b&&c&&f&&m&&d?(C(c,!1),a(function(){f+="";m+="";var a={};if(h&&"object"===typeof h)for(var r in h)a[r]=h[r];a.data=b;a.width=f;a.height=m;r={};if(n&&"object"===typeof n)for(var q in n)r[q]=n[q];if(e&&"object"===typeof e)for(var t in e)r.flashvars="undefined"!=typeof r.flashvars?r.flashvars+("\x26"+t+"\x3d"+e[t]):
t+"\x3d"+e[t];if(z(d))q=p(a,r,c),a.id==c&&C(c,!0),w.success=!0,w.ref=q;else{if(g&&k()){a.data=g;l(a,r,c,x);return}C(c,!0)}x&&x(w)})):x&&x(w)},switchOffAutoHideShow:function(){O=!1},ua:q,getFlashPlayerVersion:function(){return{major:q.pv[0],minor:q.pv[1],release:q.pv[2]}},hasFlashPlayerVersion:z,createSWF:function(a,b,c){if(q.w3)return p(a,b,c)},showExpressInstall:function(a,b,c,f){q.w3&&k()&&l(a,b,c,f)},removeSWF:function(a){q.w3&&n(a)},createCSS:function(a,b,c,f){q.w3&&w(a,b,c,f)},addDomLoadEvent:a,
addLoadEvent:e,getQueryParamValue:function(a){var b=r.location.search||r.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return G(b);for(var b=b.split("\x26"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("\x3d"))==a)return G(b[c].substring(b[c].indexOf("\x3d")+1))}return""},expressInstallCallback:function(){if(I){var a=m("SWFObjectExprInst");a&&H&&(a.parentNode.replaceChild(H,a),J&&(C(J,!0),q.ie&&q.win&&(H.style.display="block")),K&&K(N));I=!1}}}}());
(function(){if("undefined"!=typeof window&&!window.WebSocket){var b=window.console;b&&b.log&&b.error||(b={log:function(){},error:function(){}});swfobject.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&b.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,b,d,c,h){var e=this;e.__id=WebSocket.__nextId++;WebSocket.__instances[e.__id]=e;e.readyState=WebSocket.CONNECTING;
e.bufferedAmount=0;e.__events={};b?"string"==typeof b&&(b=[b]):b=[];setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(e.__id,a,b,d||null,c||0,h||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&
this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(a,b,d){a in this.__events||(this.__events[a]=[]);this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b,d){if(a in this.__events)for(a=this.__events[a],d=a.length-1;0<=d;--d)if(a[d]===b){a.splice(d,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],d=0;d<b.length;++d)b[d](a);(b=this["on"+
a.type])&&b(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);"protocol"in a&&(this.protocol=a.protocol);if("open"==a.type||"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=decodeURIComponent(a.message),a=this.__createMessageEvent("message",a);else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&
window.Event){var b=document.createEvent("Event");b.initEvent(a,!1,!1);return b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,b){return document.createEvent&&window.MessageEvent&&!window.opera?(a=document.createEvent("MessageEvent"),a.initMessageEvent("message",!1,!1,b,null,null,window,null),a):{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances=
{},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?(a.style.left="0px",a.style.top="0px"):(a.style.left=
"-100px",a.style.top="-100px");var e=document.createElement("div");e.id="webSocketFlash";a.appendChild(e);document.body.appendChild(a);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(a){a.success||b.error("[WebSocket] swfobject.embedSWF failed")})}else b.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=
document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),e=0;e<a.length;++e)WebSocket.__instances[a[e].webSocketId].__handleEvent(a[e])}catch(d){b.error(d)}},0);return!0},WebSocket.__log=function(a){b.log(decodeURIComponent(a))},
WebSocket.__error=function(a){b.error(decodeURIComponent(a))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin&&a.enabledPlugin.filename?a.enabledPlugin.filename.match(/flashlite/i)?!0:!1:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",
function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))):b.error("Flash Player \x3e\x3d 10.0.0 is required.")}})();
(function(b,a,e){function d(b){b&&(a.Transport.apply(this,arguments),this.sendBuffer=[])}function c(){}b.XHR=d;a.util.inherit(d,a.Transport);d.prototype.open=function(){this.socket.setBuffer(!1);this.onOpen();this.get();this.setCloseTimeout();return this};d.prototype.payload=function(b){for(var c=[],d=0,f=b.length;d<f;d++)c.push(a.parser.encodePacket(b[d]));this.send(a.parser.encodePayload(c))};d.prototype.send=function(a){this.post(a);return this};d.prototype.post=function(a){function b(){if(4==
this.readyState)if(this.onreadystatechange=c,f.posting=!1,200==this.status)f.socket.setBuffer(!1);else f.onClose()}function d(){this.onload=c;f.socket.setBuffer(!1)}var f=this;this.socket.setBuffer(!0);this.sendXHR=this.request("POST");e.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=d:this.sendXHR.onreadystatechange=b;this.sendXHR.send(a)};d.prototype.close=function(){this.onClose();return this};d.prototype.request=function(b){var c=a.util.request(this.socket.isXDomain()),
d=a.util.query(this.socket.options.query,"t\x3d"+ +new Date);c.open(b||"GET",this.prepareUrl()+d,!0);if("POST"==b)try{c.setRequestHeader?c.setRequestHeader("Content-type","text/plain;charset\x3dUTF-8"):c.contentType="text/plain"}catch(f){}return c};d.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};d.check=function(b,c){try{var d=a.util.request(c),f=e.XDomainRequest&&d instanceof XDomainRequest,g=(b&&b.options&&b.options.secure?"https:":"http:")!=e.location.protocol;if(d&&
(!f||!g))return!0}catch(p){}return!1};d.xdomainCheck=function(){return d.check(null,!0)}})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(b,a){function e(b){a.Transport.XHR.apply(this,arguments)}b.htmlfile=e;a.util.inherit(e,a.Transport.XHR);e.prototype.name="htmlfile";e.prototype.get=function(){this.doc=new (window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();this.doc.write("\x3chtml\x3e\x3c/html\x3e");this.doc.close();this.doc.parentWindow.s=this;var b=this.doc.createElement("div");b.className="socketio";this.doc.body.appendChild(b);this.iframe=this.doc.createElement("iframe");b.appendChild(this.iframe);
var c=this,b=a.util.query(this.socket.options.query,"t\x3d"+ +new Date);this.iframe.src=this.prepareUrl()+b;a.util.on(window,"unload",function(){c.destroy()})};e.prototype._=function(a,b){this.onData(a);try{var c=b.getElementsByTagName("script")[0];c.parentNode.removeChild(c)}catch(k){}};e.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(d){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};e.prototype.close=function(){this.destroy();
return a.Transport.XHR.prototype.close.call(this)};e.check=function(){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{return new (window[["Active"].concat("Object").join("X")])("htmlfile"),a.Transport.XHR.check()}catch(d){}return!1};e.xdomainCheck=function(){return!1};a.transports.push("htmlfile")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(b,a,e){function d(){a.Transport.XHR.apply(this,arguments)}function c(){}b["xhr-polling"]=d;a.util.inherit(d,a.Transport.XHR);a.util.merge(d,a.Transport.XHR);d.prototype.name="xhr-polling";d.prototype.open=function(){a.Transport.XHR.prototype.open.call(this);return!1};d.prototype.get=function(){function a(){if(4==this.readyState)if(this.onreadystatechange=c,200==this.status)f.onData(this.responseText),f.get();else f.onClose()}function b(){this.onerror=this.onload=c;f.onData(this.responseText);
f.get()}function d(){f.onClose()}if(this.open){var f=this;this.xhr=this.request();e.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=b,this.xhr.onerror=d):this.xhr.onreadystatechange=a;this.xhr.send(null)}};d.prototype.onClose=function(){a.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=c;try{this.xhr.abort()}catch(h){}this.xhr=null}};d.prototype.ready=function(b,c){var d=this;a.util.defer(function(){c.call(d)})};
a.transports.push("xhr-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(b,a,e){function d(b){a.Transport["xhr-polling"].apply(this,arguments);this.index=a.j.length;var c=this;a.j.push(function(a){c._(a)})}var c=e.document&&"MozAppearance"in e.document.documentElement.style;b["jsonp-polling"]=d;a.util.inherit(d,a.Transport["xhr-polling"]);d.prototype.name="jsonp-polling";d.prototype.post=function(b){function c(){d();g.socket.setBuffer(!1)}function d(){g.iframe&&g.form.removeChild(g.iframe);try{f=document.createElement('\x3ciframe name\x3d"'+g.iframeId+'"\x3e')}catch(z){f=
document.createElement("iframe"),f.name=g.iframeId}f.id=g.iframeId;g.form.appendChild(f);g.iframe=f}var f,g=this,e=a.util.query(this.socket.options.query,"t\x3d"+ +new Date+"\x26i\x3d"+this.index);if(!this.form){var n=document.createElement("form"),m=document.createElement("textarea"),x=this.iframeId="socketio_iframe_"+this.index;n.className="socketio";n.style.position="absolute";n.style.top="0px";n.style.left="0px";n.style.display="none";n.target=x;n.method="POST";n.setAttribute("accept-charset",
"utf-8");m.name="d";n.appendChild(m);document.body.appendChild(n);this.form=n;this.area=m}this.form.action=this.prepareUrl()+e;d();this.area.value=a.JSON.stringify(b);try{this.form.submit()}catch(z){}this.iframe.attachEvent?f.onreadystatechange=function(){"complete"==g.iframe.readyState&&c()}:this.iframe.onload=c;this.socket.setBuffer(!0)};d.prototype.get=function(){var b=this,d=document.createElement("script"),e=a.util.query(this.socket.options.query,"t\x3d"+ +new Date+"\x26i\x3d"+this.index);this.script&&
(this.script.parentNode.removeChild(this.script),this.script=null);d.async=!0;d.src=this.prepareUrl()+e;d.onerror=function(){b.onClose()};e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(d,e);this.script=d;c&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};d.prototype._=function(a){this.onData(a);this.open&&this.get();return this};d.prototype.ready=function(b,d){var e=this;if(!c)return d.call(this);
a.util.load(function(){d.call(e)})};d.check=function(){return"document"in e};d.xdomainCheck=function(){return!0};a.transports.push("jsonp-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);var Erizo=Erizo||{};
Erizo.EventDispatcher=function(b){var a={};b.dispatcher={};b.dispatcher.eventListeners={};a.addEventListener=function(a,d){void 0===b.dispatcher.eventListeners[a]&&(b.dispatcher.eventListeners[a]=[]);b.dispatcher.eventListeners[a].push(d)};a.removeEventListener=function(a,d){d=b.dispatcher.eventListeners[a].indexOf(d);-1!==d&&b.dispatcher.eventListeners[a].splice(d,1)};a.dispatchEvent=function(a){var d;L.Logger.debug("Event: "+a.type);for(d in b.dispatcher.eventListeners[a.type])if(b.dispatcher.eventListeners[a.type].hasOwnProperty(d))b.dispatcher.eventListeners[a.type][d](a)};return a};
Erizo.LicodeEvent=function(b){var a={};a.type=b.type;return a};Erizo.RoomEvent=function(b){var a=Erizo.LicodeEvent(b);a.streams=b.streams;a.message=b.message;return a};Erizo.StreamEvent=function(b){var a=Erizo.LicodeEvent(b);a.stream=b.stream;a.msg=b.msg;a.bandwidth=b.bandwidth;return a};Erizo.PublisherEvent=function(b){return Erizo.LicodeEvent(b)};Erizo=Erizo||{};
Erizo.FcStack=function(b){var a={pcConfig:{},peerConnection:{},desc:{},signalCallback:void 0},e=e||{};a.close=function(){e.Logger.info("Close FcStack")};a.createOffer=function(){e.Logger.debug("FCSTACK: CreateOffer")};a.addStream=function(a){e.Logger.debug("FCSTACK: addStream",a)};a.processSignalingMessage=function(b){e.Logger.debug("FCSTACK: processSignaling",b);void 0!==a.signalCallback&&a.signalCallback(b)};a.sendSignalingMessage=function(a){e.Logger.debug("FCSTACK: Sending signaling Message",a);
b.callback(a)};a.setSignalingCallback=function(b){e.Logger.debug("FCSTACK: Setting signalling callback");a.signalCallback=b};return a};Erizo=Erizo||{};
Erizo.BowserStack=function(b){var a={},e=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={offerToReceiveVideo:b.video,offerToReceiveAudio:b.audio};a.peerConnection=
new e(a.pcConfig,a.con);b.remoteDescriptionSet=!1;var d=function(a){if(b.maxVideoBW){var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var f=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],f)}}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(f=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],f)));return a};a.close=function(){a.state="closed";a.peerConnection.close()};b.localCandidates=[];a.peerConnection.onicecandidate=
function(c){c.candidate?(c.candidate.candidate.match(/a=/)||(c.candidate.candidate="a\x3d"+c.candidate.candidate),b.remoteDescriptionSet?b.callback({type:"candidate",candidate:c.candidate}):b.localCandidates.push(c.candidate)):console.log("End of candidates.",a.peerConnection.localDescription)};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};var c=function(a){console.log("Error in Stack ",
a)},h,k=function(f){f.sdp=d(f.sdp);console.log("Set local description",f.sdp);h=f;a.peerConnection.setLocalDescription(h,function(){console.log("The final LocalDesc",a.peerConnection.localDescription);b.callback(a.peerConnection.localDescription)},c)},l=function(c){c.sdp=d(c.sdp);b.callback(c);h=c;a.peerConnection.setLocalDescription(c)};a.createOffer=function(b){!0===b?a.peerConnection.createOffer(k,c,a.mediaConstraints):a.peerConnection.createOffer(k,c)};a.addStream=function(b){a.peerConnection.addStream(b)};
b.remoteCandidates=[];a.processSignalingMessage=function(f){console.log("Process Signaling Message",f);if("offer"===f.type)f.sdp=d(f.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(f)),a.peerConnection.createAnswer(l,null,a.mediaConstraints),b.remoteDescriptionSet=!0;else if("answer"===f.type)console.log("Set remote description",f.sdp),f.sdp=d(f.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(f),function(){b.remoteDescriptionSet=!0;for(console.log("Candidates to be added: ",
b.remoteCandidates.length);0<b.remoteCandidates.length;)console.log("Candidate :",b.remoteCandidates[b.remoteCandidates.length-1]),a.peerConnection.addIceCandidate(b.remoteCandidates.shift(),function(){},c);for(;0<b.localCandidates.length;)b.callback({type:"candidate",candidate:b.localCandidates.shift()})},function(){console.log("Error Setting Remote Description")});else if("candidate"===f.type){console.log("Message with candidate");try{var g="object"===typeof f.candidate?f.candidate:JSON.parse(f.candidate);
g.candidate=g.candidate.replace(/a=/g,"");g.sdpMLineIndex=parseInt(g.sdpMLineIndex);g.sdpMLineIndex="audio"===g.sdpMid?0:1;var e=new RTCIceCandidate(g);console.log("Remote Candidate",e);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(e,function(){},c):b.remoteCandidates.push(e)}catch(n){L.Logger.error("Error parsing candidate",f.candidate)}}};return a};Erizo=Erizo||{};
Erizo.FirefoxStack=function(b){var a={},e=mozRTCPeerConnection,d=mozRTCSessionDescription,c=mozRTCIceCandidate;a.pcConfig={iceServers:[]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,mozDontOfferDataChannel:!0};var h=function(a){L.Logger.error("Error in Stack ",a)},k=function(){b.video&&b.simulcast&&a.peerConnection.getSenders().forEach(function(a){"video"===a.track.kind&&
(a.getParameters(),a.setParameters({encodings:[{rid:"spam",active:!0,priority:"high",maxBitrate:4E4,maxHeight:640,maxWidth:480},{rid:"egg",active:!0,priority:"medium",maxBitrate:1E4,maxHeight:320,maxWidth:240}]}))})},l=!1;a.peerConnection=new e(a.pcConfig,a.con);b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(l=!0,a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a=a.candidate,b.remoteDescriptionSet?b.callback({type:"candidate",
candidate:a}):(b.localCandidates.push(a),L.Logger.debug("Local Candidates stored: ",b.localCandidates.length,b.localCandidates))):L.Logger.info("Gathered all candidates. Sending END candidate")};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};
var f=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var f=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],f)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(f=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],f)));return a},g,p=function(a){a.sdp=f(a.sdp);a.sdp=a.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback(a);g=a},
n=function(c){c.sdp=f(c.sdp);c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback(c);g=c;a.peerConnection.setLocalDescription(g)};a.updateSpec=function(a){if(a.maxVideoBW||a.maxAudioBW)a.maxVideoBW&&(L.Logger.debug("Maxvideo Requested",a.maxVideoBW,"limit",b.limitMaxVideoBW),a.maxVideoBW>b.limitMaxVideoBW&&(a.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=a.maxVideoBW,L.Logger.debug("Result",b.maxVideoBW)),a.maxAudioBW&&(a.maxAudioBW>b.limitMaxAudioBW&&(a.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=
a.maxAudioBW),g.sdp=f(g.sdp),a.Sdp?L.Logger.error("Cannot update with renegotiation in Firefox, try without renegotiation"):(L.Logger.debug("Updating without renegotiation, newVideoBW:",b.maxVideoBW,", newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:g.sdp}));if(a.minVideoBW||void 0!==a.slideShowMode||void 0!==a.muteStream||void 0!==a.qualityLayer)L.Logger.debug("MinVideo Changed to ",a.minVideoBW),L.Logger.debug("SlideShowMode Changed to ",a.slideShowMode),L.Logger.debug("muteStream changed to ",
a.muteStream),b.callback({type:"updatestream",config:a})};a.createOffer=function(b){!0!==b&&(k(),a.mediaConstraints={offerToReceiveAudio:!1,offerToReceiveVideo:!1,mozDontOfferDataChannel:!0});a.peerConnection.createOffer(p,h,a.mediaConstraints)};a.addStream=function(b){a.peerConnection.addStream(b)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.close=function(){a.state="closed";a.peerConnection.close()};a.processSignalingMessage=function(e){if("offer"===e.type)e.sdp=f(e.sdp),a.peerConnection.setRemoteDescription(new d(e),
function(){a.peerConnection.createAnswer(n,function(a){L.Logger.error("Error",a)},a.mediaConstraints);b.remoteDescriptionSet=!0},function(a){L.Logger.error("Error setting Remote Description",a)});else if("answer"===e.type)L.Logger.info("Set remote and local description"),L.Logger.debug("Local Description to set",g.sdp),L.Logger.debug("Remote Description to set",e.sdp),e.sdp=f(e.sdp),a.peerConnection.setLocalDescription(g,function(){a.peerConnection.setRemoteDescription(new d(e),function(){b.remoteDescriptionSet=
!0;for(L.Logger.info("Remote Description successfully set");0<b.remoteCandidates.length&&l;)L.Logger.info("Setting stored remote candidates"),a.peerConnection.addIceCandidate(b.remoteCandidates.shift());for(;0<b.localCandidates.length;)L.Logger.info("Sending Candidate from list"),b.callback({type:"candidate",candidate:b.localCandidates.shift()})},function(a){L.Logger.error("Error Setting Remote Description",a)})},function(a){L.Logger.error("Failure setting Local Description",a)});else if("candidate"===
e.type)try{var m="object"===typeof e.candidate?e.candidate:JSON.parse(e.candidate);m.candidate=m.candidate.replace(/ generation 0/g,"");m.candidate=m.candidate.replace(/ udp /g," UDP ");m.sdpMLineIndex=parseInt(m.sdpMLineIndex);var h=new c(m);if(b.remoteDescriptionSet&&l)for(a.peerConnection.addIceCandidate(h);0<b.remoteCandidates.length;)L.Logger.info("Setting stored remote candidates"),a.peerConnection.addIceCandidate(b.remoteCandidates.shift());else b.remoteCandidates.push(h)}catch(w){L.Logger.error("Error parsing candidate",
e.candidate,w)}};return a};Erizo=Erizo||{};
Erizo.ChromeStableStack=function(b){var a={},e=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.iceServers&&(a.pcConfig.iceServers=b.iceServers);void 0===b.audio&&(b.audio=!0);void 0===b.video&&(b.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};var d=function(a){L.Logger.error("Error in Stack ",a)};a.peerConnection=new e(a.pcConfig,a.con);var c=function(a){var b="a\x3dssrc-group:SIM";a.forEach(function(a){b+=
" "+a});return b+"\r\n"},h=function(a){if(!b.video||!b.simulcast)return a;var f=a.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/);if(!f||0>=f.length)return a;var d=b.simulcast.numSpatialLayers||2;var g=parseInt(f[1]),e=parseInt(f[2]),n=a.match(new RegExp("a\x3dssrc:"+f[1]+" cname:(.*)\r?\n"))[1],h=a.match(new RegExp("a\x3dssrc:"+f[1]+" msid:(.*)\r?\n"))[1],p=a.match(new RegExp("a\x3dssrc:"+f[1]+" mslabel:(.*)\r?\n"))[1],k=a.match(new RegExp("a\x3dssrc:"+f[1]+" label:(.*)\r?\n"))[1];a.match(new RegExp("a\x3dssrc:"+
f[1]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});a.match(new RegExp("a\x3dssrc:"+f[2]+".*\r?\n","g")).forEach(function(b){a=a.replace(b,"")});for(var l=[g],B=[e],u=1;u<d;u++)l.push(g+1E3*u),B.push(e+1E3*u);d=c(l);for(var y in l)g=l[y],e=B[y],d+="a\x3dssrc-group:FID "+g+" "+e+"\r\n";for(var E in l)g=l[E],e=B[E],d+="a\x3dssrc:"+g+" cname:"+n+"\r\na\x3dssrc:"+g+" msid:"+h+"\r\na\x3dssrc:"+g+" mslabel:"+p+"\r\na\x3dssrc:"+g+" label:"+k+"\r\na\x3dssrc:"+e+" cname:"+n+"\r\na\x3dssrc:"+e+" msid:"+
h+"\r\na\x3dssrc:"+e+" mslabel:"+p+"\r\na\x3dssrc:"+e+" label:"+k+"\r\n";return a.replace(f[0],d+"a\x3dx-google-flag:conference\r\n")},k=function(a){if(b.video&&b.maxVideoBW){a=a.replace(/b=AS:.*\r\n/g,"");var c=a.match(/m=video.*\r\n/);null==c&&(c=a.match(/m=video.*\n/));if(c&&0<c.length){var f=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],f)}}b.audio&&b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/),null==c&&(c=a.match(/m=audio.*\n/)),c&&0<c.length&&(f=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],
f)));return a};a.close=function(){a.state="closed";a.peerConnection.close()};b.localCandidates=[];a.peerConnection.onicecandidate=function(a){a.candidate?(a.candidate.candidate.match(/a=/)||(a.candidate.candidate="a\x3d"+a.candidate.candidate),a={sdpMLineIndex:a.candidate.sdpMLineIndex,sdpMid:a.candidate.sdpMid,candidate:a.candidate.candidate}):(L.Logger.info("Gathered all candidates. Sending END candidate"),a={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"});b.remoteDescriptionSet?b.callback({type:"candidate",
candidate:a}):(b.localCandidates.push(a),L.Logger.info("Storing candidate: ",b.localCandidates.length,a))};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.target.iceConnectionState)};var l,f,g=function(a,c){a||(c.sdp=h(c.sdp));c.sdp=k(c.sdp);a=c.sdp;var f=a.match(/a=rtpmap:(.*)opus.*\r\n/);
null!==f&&(a=a.replace(f[0],f[0]+"a\x3drtcp-fb:"+f[1]+"nack\r\n"));c.sdp=a;c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,"");b.callback({type:c.type,sdp:c.sdp});l=c},p=function(c){c.sdp=k(c.sdp);b.callback({type:c.type,sdp:c.sdp});l=c;a.peerConnection.setLocalDescription(c)};a.updateSpec=function(c,d){if(c.maxVideoBW||c.maxAudioBW)c.maxVideoBW&&(L.Logger.debug("Maxvideo Requested:",c.maxVideoBW,"limit:",b.limitMaxVideoBW),c.maxVideoBW>b.limitMaxVideoBW&&(c.maxVideoBW=b.limitMaxVideoBW),b.maxVideoBW=
c.maxVideoBW,L.Logger.debug("Result",b.maxVideoBW)),c.maxAudioBW&&(c.maxAudioBW>b.limitMaxAudioBW&&(c.maxAudioBW=b.limitMaxAudioBW),b.maxAudioBW=c.maxAudioBW),l.sdp=k(l.sdp),c.Sdp||c.maxAudioBW?(L.Logger.debug("Updating with SDP renegotiation",b.maxVideoBW,b.maxAudioBW),a.peerConnection.setLocalDescription(l,function(){f.sdp=k(f.sdp);a.peerConnection.setRemoteDescription(new RTCSessionDescription(f),function(){b.remoteDescriptionSet=!0;b.callback({type:"updatestream",sdp:l.sdp})})},function(a){L.Logger.error("Error updating configuration",
a);d("error")})):(L.Logger.debug("Updating without SDP renegotiation, newVideoBW:",b.maxVideoBW,"newAudioBW:",b.maxAudioBW),b.callback({type:"updatestream",sdp:l.sdp}));if(c.minVideoBW||void 0!==c.slideShowMode||void 0!==c.muteStream||void 0!==c.qualityLayer)L.Logger.debug("MinVideo Changed to ",c.minVideoBW),L.Logger.debug("SlideShowMode Changed to ",c.slideShowMode),L.Logger.debug("muteStream changed to ",c.muteStream),b.callback({type:"updatestream",config:c})};a.createOffer=function(b){!0!==b&&
(a.mediaConstraints={mandatory:{OfferToReceiveVideo:!1,OfferToReceiveAudio:!1}});a.peerConnection.createOffer(g.bind(null,b),d,a.mediaConstraints)};a.addStream=function(b){a.peerConnection.addStream(b)};b.remoteCandidates=[];b.remoteDescriptionSet=!1;a.processSignalingMessage=function(c){if("offer"===c.type)c.sdp=k(c.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){a.peerConnection.createAnswer(p,function(a){L.Logger.error("Error: ",a)},a.mediaConstraints);b.remoteDescriptionSet=
!0},function(a){L.Logger.error("Error setting Remote Description",a)});else if("answer"===c.type)L.Logger.info("Set remote and local description"),L.Logger.debug("Remote Description",c.sdp),L.Logger.debug("Local Description",l.sdp),c.sdp=k(c.sdp),f=c,a.peerConnection.setLocalDescription(l,function(){a.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.remoteDescriptionSet=!0;for(L.Logger.info("Candidates to be added: ",b.remoteCandidates.length,b.remoteCandidates);0<b.remoteCandidates.length;)a.peerConnection.addIceCandidate(b.remoteCandidates.shift());
for(L.Logger.info("Local candidates to send:",b.localCandidates.length);0<b.localCandidates.length;)b.callback({type:"candidate",candidate:b.localCandidates.shift()})})});else if("candidate"===c.type)try{var d="object"===typeof c.candidate?c.candidate:JSON.parse(c.candidate);if("end"!==d.candidate){d.candidate=d.candidate.replace(/a=/g,"");d.sdpMLineIndex=parseInt(d.sdpMLineIndex);var g=new RTCIceCandidate(d);b.remoteDescriptionSet?a.peerConnection.addIceCandidate(g):b.remoteCandidates.push(g)}}catch(z){L.Logger.error("Error parsing candidate",
c.candidate)}};return a};Erizo=Erizo||{};
Erizo.ChromeCanaryStack=function(b){var a={},e=webkitRTCPeerConnection;a.pcConfig={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};void 0!==b.stunServerUrl&&a.pcConfig.iceServers.push({url:b.stunServerUrl});(b.turnServer||{}).url&&a.pcConfig.iceServers.push({username:b.turnServer.username,credential:b.turnServer.password,url:b.turnServer.url});if(void 0===b.audio||b.nop2p)b.audio=!0;if(void 0===b.video||b.nop2p)b.video=!0;a.mediaConstraints={mandatory:{OfferToReceiveVideo:b.video,OfferToReceiveAudio:b.audio}};
a.roapSessionId=103;a.peerConnection=new e(a.pcConfig,a.con);a.peerConnection.onicecandidate=function(c){L.Logger.debug("PeerConnection: ",b.sessionId);c.candidate?a.iceCandidateCount+=1:(L.Logger.debug("State: "+a.peerConnection.iceGatheringState),void 0===a.ices&&(a.ices=0),a.ices+=1,1<=a.ices&&a.moreIceComing&&(a.moreIceComing=!1,a.markActionNeeded()))};var d=function(a){var c;if(b.maxVideoBW&&(c=a.match(/m=video.*\r\n/))&&0<c.length){var d=c[0]+"b\x3dAS:"+b.maxVideoBW+"\r\n";a=a.replace(c[0],
d)}b.maxAudioBW&&(c=a.match(/m=audio.*\r\n/))&&0<c.length&&(d=c[0]+"b\x3dAS:"+b.maxAudioBW+"\r\n",a=a.replace(c[0],d));return a};a.processSignalingMessage=function(b){L.Logger.debug("Activity on conn "+a.sessionId);b=JSON.parse(b);a.incomingMessage=b;"new"===a.state?"OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+
a.state):"offer-sent"===a.state?"ANSWER"===b.messageType?(b={sdp:b.sdp,type:"answer"},L.Logger.debug("Received ANSWER: ",b.sdp),b.sdp=d(b.sdp),a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.sendOK(),a.state="established"):"pr-answer"===b.messageType?(b={sdp:b.sdp,type:"pr-answer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))):"offer"===b.messageType?a.error("Not written yet"):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state):
"established"===a.state&&("OFFER"===b.messageType?(b={sdp:b.sdp,type:"offer"},a.peerConnection.setRemoteDescription(new RTCSessionDescription(b)),a.state="offer-received",a.markActionNeeded()):a.error("Illegal message for this state: "+b.messageType+" in state "+a.state))};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(){a.markActionNeeded()};a.close=function(){a.state="closed";a.peerConnection.close()};a.markActionNeeded=function(){a.actionNeeded=
!0;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){if(a.actionNeeded){if("new"===a.state||"established"===a.state)a.peerConnection.createOffer(function(b){b.sdp=d(b.sdp);L.Logger.debug("Changed",b.sdp);b.sdp!==a.prevOffer?(a.peerConnection.setLocalDescription(b),a.state="preparing-offer",a.markActionNeeded()):L.Logger.debug("Not sending a new offer")},null,a.mediaConstraints);else if("preparing-offer"===a.state){if(a.moreIceComing)return;
a.prevOffer=a.peerConnection.localDescription.sdp;L.Logger.debug("Sending OFFER: "+a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if("offer-received"===a.state)a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);a.state="offer-received-preparing-answer";a.iceStarted?a.markActionNeeded():(L.Logger.debug((new Date).getTime()+": Starting ICE in responder"),a.iceStarted=!0)},null,a.mediaConstraints);else if("offer-received-preparing-answer"===a.state){if(a.moreIceComing)return;
var b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=!1}};a.sendOK=function(){a.sendMessage("OK")};a.sendMessage=function(b,d){var c={};c.messageType=b;c.sdp=d;"OFFER"===b?(c.offererSessionId=a.sessionId,c.answererSessionId=a.otherSessionId,c.seq=a.sequenceNumber+=1,c.tiebreaker=Math.floor(429496723*Math.random()+1)):(c.offererSessionId=a.incomingMessage.offererSessionId,c.answererSessionId=
a.sessionId,c.seq=a.incomingMessage.seq);a.onsignalingmessage(JSON.stringify(c))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=b.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};
a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};a.onaddstream=null;a.onremovestream=null;a.state="new";a.markActionNeeded();return a};Erizo=Erizo||{};Erizo.sessionId=103;
Erizo.Connection=function(b){var a={};b.sessionId=Erizo.sessionId+=1;a.browser=Erizo.getBrowser();if("fake"===a.browser)L.Logger.warning("Publish/subscribe video/audio streams not supported in erizofc yet"),a=Erizo.FcStack(b);else if("mozilla"===a.browser)L.Logger.debug("Firefox Stack"),a=Erizo.FirefoxStack(b);else if("bowser"===a.browser)L.Logger.debug("Bowser Stack"),a=Erizo.BowserStack(b);else if("chrome-stable"===a.browser||"electron"===a.browser)L.Logger.debug("Chrome Stable Stack"),a=Erizo.ChromeStableStack(b);
else throw L.Logger.error("No stack available for this browser"),"WebRTC stack not available";a.updateSpec||(a.updateSpec=function(a,b){L.Logger.error("Update Configuration not implemented in this browser");b&&b("unimplemented")});return a};
Erizo.getBrowser=function(){var b="none";"undefined"!==typeof module&&module.exports?b="fake":null!==window.navigator.userAgent.match("Firefox")?b="mozilla":null!==window.navigator.userAgent.match("Bowser")?b="bowser":null!==window.navigator.userAgent.match("Chrome")?(b="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(b="electron")):null!==window.navigator.userAgent.match("Safari")?b="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(b="bowser");return b};
Erizo.GetUserMedia=function(b,a,e){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(b.screen)switch(L.Logger.debug("Screen access requested"),Erizo.getBrowser()){case "electron":L.Logger.debug("Screen sharing in Electron");var d={};d.video=b.video||{};d.video.mandatory=b.video.mandatory||{};d.video.mandatory.chromeMediaSource="screen";navigator.getMedia(d,a,e);break;case "mozilla":L.Logger.debug("Screen sharing in Firefox");
d={};void 0!==b.video.mandatory?(d.video=b.video,d.video.mediaSource="window"):d={audio:b.audio,video:{mediaSource:"window"}};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(d=navigator.mediaDevices.getUserMedia(d).then(a),d["catch"](e)):navigator.getMedia(d,a,e);break;case "chrome-stable":L.Logger.debug("Screen sharing in Chrome");if(b.desktopStreamId)d={},d.video=b.video||{},d.video.mandatory.chromeMediaSource="desktop",d.video.mandatory.chromeMediaSourceId=b.desktopStreamId,navigator.getMedia(d,
a,e);else{d="okeephmleflklcdebijnponpabbmmgeo";b.extensionId&&(L.Logger.debug("extensionId supplied, using "+b.extensionId),d=b.extensionId);L.Logger.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(d,{getStream:!0},function(c){var d={};void 0===c?(L.Logger.error("Access to screen denied"),e({code:"Access to screen denied"})):(c=c.streamId,void 0!==b.video.mandatory?(d.video=b.video,d.video.mandatory.chromeMediaSource="desktop",d.video.mandatory.chromeMediaSourceId=
c):d={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:c}}},navigator.getMedia(d,a,e))})}catch(h){L.Logger.debug("Screensharing plugin is not accessible "),e({code:"no_plugin_present"})}}break;default:L.Logger.error("This browser does not support ScreenSharing")}else if("undefined"!==typeof module&&module.exports)L.Logger.error("Video/audio streams not supported in erizofc yet");else{if(b.video&&"mozilla"===Erizo.getBrowser()){d={video:{},audio:b.audio,screen:b.screen};if(void 0!==
b.audio.mandatory){var c=b.audio.mandatory;c.sourceId&&(d.audio.deviceId=c.sourceId)}void 0!==b.video.mandatory&&(c=b.video.mandatory,d.video.width={min:c.minWidth,max:c.maxWidth},d.video.height={min:c.minHeight,max:c.maxHeight},c.sourceId&&(d.video.deviceId=c.sourceId));void 0!==b.video.optional&&(d.video.frameRate=b.video.optional[1].maxFrameRate);if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){d=navigator.mediaDevices.getUserMedia(d).then(a);d["catch"](e);return}}navigator.getMedia(b,
a,e)}};Erizo=Erizo||{};
Erizo.Stream=function(b){var a=Erizo.EventDispatcher(b);a.stream=b.stream;a.url=b.url;a.recording=b.recording;a.room=void 0;a.showing=!1;a.local=!1;a.video=b.video;a.audio=b.audio;a.screen=b.screen;a.videoSize=b.videoSize;a.videoFrameRate=b.videoFrameRate;a.extensionId=b.extensionId;a.desktopStreamId=b.desktopStreamId;if(!(void 0===a.videoSize||a.videoSize instanceof Array&&4===a.videoSize.length))throw Error("Invalid Video Size");if(void 0===b.local||!0===b.local)a.local=!0;a.getID=function(){return a.local&&
!b.streamID?"local":b.streamID};a.getAttributes=function(){return b.attributes};a.setAttributes=function(){L.Logger.error("Failed to set attributes data. This Stream object has not been published.")};a.updateLocalAttributes=function(a){b.attributes=a};a.hasAudio=function(){return b.audio};a.hasVideo=function(){return b.video};a.hasData=function(){return b.data};a.hasScreen=function(){return b.screen};a.sendData=function(){L.Logger.error("Failed to send data. This Stream object has not that channel enabled.")};
a.init=function(){try{if((b.audio||b.video||b.screen)&&void 0===b.url){L.Logger.info("Requested access to local media");var c=b.video;!0===c||!0===b.screen?(c=!0===c?{}:c,void 0!==a.videoSize&&(c.mandatory=c.mandatory||{},c.mandatory.minWidth=a.videoSize[0],c.mandatory.minHeight=a.videoSize[1],c.mandatory.maxWidth=a.videoSize[2],c.mandatory.maxHeight=a.videoSize[3]),void 0!==a.videoFrameRate&&(c.optional=c.optional||[],c.optional.push({minFrameRate:a.videoFrameRate[0]}),c.optional.push({maxFrameRate:a.videoFrameRate[1]}))):
!0===b.screen&&void 0===c&&(c=!0);Erizo.GetUserMedia({video:c,audio:b.audio,fake:b.fake,screen:b.screen,extensionId:a.extensionId,desktopStreamId:a.desktopStreamId},function(b){L.Logger.info("User has granted access to local media.");a.stream=b;d=Erizo.StreamEvent({type:"access-accepted"});a.dispatchEvent(d);a.stream.getTracks().forEach(function(b){b.onended=function(){a.stream.getTracks().forEach(function(a){a.onended=null});d=Erizo.StreamEvent({type:"stream-ended",stream:a,msg:b.kind});a.dispatchEvent(d)}})},
function(b){L.Logger.error("Failed to get access to local media. Error code was "+b.code+".");b=Erizo.StreamEvent({type:"access-denied",msg:b});a.dispatchEvent(b)})}else{var d=Erizo.StreamEvent({type:"access-accepted"});a.dispatchEvent(d)}}catch(k){L.Logger.error("Failed to get access to local media. Error was "+k+"."),d=Erizo.StreamEvent({type:"access-denied",msg:k}),a.dispatchEvent(d)}};a.close=function(){a.local&&(void 0!==a.room&&a.room.unpublish(a),a.hide(),void 0!==a.stream&&a.stream.getTracks().forEach(function(a){a.onended=
null;a.stop()}),a.stream=void 0)};a.play=function(b,d){d=d||{};a.elementID=b;a.hasVideo()||this.hasScreen()?void 0!==b&&(b=new Erizo.VideoPlayer({id:a.getID(),stream:a,elementID:b,options:d}),a.player=b,a.showing=!0):a.hasAudio&&(b=new Erizo.AudioPlayer({id:a.getID(),stream:a,elementID:b,options:d}),a.player=b,a.showing=!0)};a.stop=function(){a.showing&&void 0!==a.player&&(a.player.destroy(),a.showing=!1)};a.show=a.play;a.hide=a.stop;var e=function(){if(void 0!==a.player&&void 0!==a.stream){var b=
a.player.video,d=document.defaultView.getComputedStyle(b),e=parseInt(d.getPropertyValue("width"),10),l=parseInt(d.getPropertyValue("height"),10),f=parseInt(d.getPropertyValue("left"),10),d=parseInt(d.getPropertyValue("top"),10);var g="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID);var p=document.defaultView.getComputedStyle(g);g=parseInt(p.getPropertyValue("width"),10);var p=parseInt(p.getPropertyValue("height"),10),n=document.createElement("canvas");
n.id="testing";n.width=g;n.height=p;n.setAttribute("style","display: none");n.getContext("2d").drawImage(b,f,d,e,l);return n}return null};a.getVideoFrameURL=function(a){var b=e();return null!==b?a?b.toDataURL(a):b.toDataURL():null};a.getVideoFrame=function(){var a=e();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null};a.checkOptions=function(b,d){if(!0===d){if(b.video||b.audio||b.screen)L.Logger.warning("Cannot update type of subscription"),b.video=void 0,b.audio=void 0,b.screen=
void 0}else!1===a.local&&(!0===b.video&&!1===a.hasVideo()&&(L.Logger.warning("Trying to subscribe to video when there is no video, won't subscribe to video"),b.video=!1),!0===b.audio&&!1===a.hasAudio()&&(L.Logger.warning("Trying to subscribe to audio when there is no audio, won't subscribe to audio"),b.audio=!1));!1!==a.local||a.hasVideo()||!0!==b.slideShowMode||(L.Logger.warning("Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),b.slideShowMode=!1)};a.muteAudio=
function(b,d){a.room&&a.room.p2p?(L.Logger.warning("muteAudio is not implemented in p2p streams"),d("error")):(b={muteStream:{audio:b}},a.checkOptions(b,!0),a.pc.updateSpec(b,d))};a._setQualityLayer=function(b,d,e){a.room&&a.room.p2p?(L.Logger.warning("setQualityLayer is not implemented in p2p streams"),e("error")):(b={qualityLayer:{spatialLayer:b,temporalLayer:d}},a.checkOptions(b,!0),a.pc.updateSpec(b,e))};var d=function(b,d,e){!0!==d&&(d=!1);b="string"===typeof b?[b]:b;b=b instanceof Array?b:[];
0<b.length&&a.room.sendControlMessage(a,"control",{name:"controlhandlers",enable:e,publisherSide:d,handlers:b})};a.disableHandlers=function(a,b){d(a,b,!1)};a.enableHandlers=function(a,b){d(a,b,!0)};a.updateConfiguration=function(b,d){if(void 0!==b)if(a.pc)if(a.checkOptions(b,!0),a.local)if(a.room.p2p)for(var c in a.pc)a.pc[c].updateSpec(b,d);else a.pc.updateSpec(b,d);else a.pc.updateSpec(b,d);else d("This stream has no peerConnection attached, ignoring")};return a};Erizo=Erizo||{};
Erizo.Room=function(b){var a=Erizo.EventDispatcher(b);a.remoteStreams={};a.localStreams={};a.roomID="";a.socket={};a.state=0;a.p2p=!1;a.addEventListener("room-disconnected",function(){var b;a.state=0;for(b in a.remoteStreams)if(a.remoteStreams.hasOwnProperty(b)){var c=a.remoteStreams[b];e(c);delete a.remoteStreams[b];c&&!c.failed&&(c=Erizo.StreamEvent({type:"stream-removed",stream:c}),a.dispatchEvent(c))}a.remoteStreams={};for(b in a.localStreams)if(a.localStreams.hasOwnProperty(b)){c=a.localStreams[b];
if(a.p2p)for(var d in c.pc)c.pc[d].close();else c.pc.close();delete a.localStreams[b]}try{a.socket.disconnect()}catch(n){L.Logger.debug("Socket already disconnected")}a.socket=void 0});var e=function(a){void 0!==a.stream&&(a.hide(),a.pc&&(a.pc.close(),delete a.pc),a.local&&a.stream.stop(),delete a.stream)};var d=function(a,b){a.local?k("sendDataStream",{id:a.getID(),msg:b}):L.Logger.error("You can not send data through a remote stream")};var c=function(a,b){a.local?(a.updateLocalAttributes(b),k("updateStreamAttributes",
{id:a.getID(),attrs:b})):L.Logger.error("You can not update attributes in a remote stream")};var h=function(c,d,p){var f=function(c,d){c.pc=Erizo.Connection({callback:function(a){l("signaling_message",{streamId:c.getID(),peerSocket:d,msg:a})},iceServers:a.iceServers,maxAudioBW:b.maxAudioBW,maxVideoBW:b.maxVideoBW,limitMaxAudioBW:b.maxAudioBW,limitMaxVideoBW:b.maxVideoBW});c.pc.onaddstream=function(b){L.Logger.info("Stream subscribed");c.stream=b.stream;b=Erizo.StreamEvent({type:"stream-subscribed",
stream:c});a.dispatchEvent(b)}};a.socket=io.connect(c.host,{reconnect:!1,secure:c.secure,"force new connection":!0,transports:["websocket"]});a.socket.on("onAddStream",function(b){var c=Erizo.Stream({streamID:b.id,local:!1,audio:b.audio,video:b.video,data:b.data,screen:b.screen,attributes:b.attributes});c.room=a;a.remoteStreams[b.id]=c;b=Erizo.StreamEvent({type:"stream-added",stream:c});a.dispatchEvent(b)});a.socket.on("signaling_message_erizo",function(b){var c;(c=b.peerId?a.remoteStreams[b.peerId]:
a.localStreams[b.streamId])&&!c.failed&&c.pc.processSignalingMessage(b.mess)});a.socket.on("signaling_message_peer",function(b){var c=a.localStreams[b.streamId];c&&!c.failed?c.pc[b.peerSocket].processSignalingMessage(b.msg):(c=a.remoteStreams[b.streamId],c.pc||f(c,b.peerSocket),c.pc.processSignalingMessage(b.msg))});a.socket.on("publish_me",function(b){var c=a.localStreams[b.streamId];void 0===c.pc&&(c.pc={});c.pc[b.peerSocket]=Erizo.Connection({callback:function(a){l("signaling_message",{streamId:b.streamId,
peerSocket:b.peerSocket,msg:a})},audio:c.hasAudio(),video:c.hasVideo(),iceServers:a.iceServers});c.pc[b.peerSocket].oniceconnectionstatechange=function(a){"failed"===a&&(c.pc[b.peerSocket].close(),delete c.pc[b.peerSocket])};c.pc[b.peerSocket].addStream(c.stream);c.pc[b.peerSocket].createOffer()});a.socket.on("onBandwidthAlert",function(b){L.Logger.info("Bandwidth Alert on",b.streamID,"message",b.message,"BW:",b.bandwidth);if(b.streamID){var c=a.remoteStreams[b.streamID];c&&!c.failed&&(b=Erizo.StreamEvent({type:"bandwidth-alert",
stream:c,msg:b.message,bandwidth:b.bandwidth}),c.dispatchEvent(b))}});a.socket.on("onDataStream",function(b){var c=a.remoteStreams[b.id];b=Erizo.StreamEvent({type:"stream-data",msg:b.msg,stream:c});c.dispatchEvent(b)});a.socket.on("onUpdateAttributeStream",function(b){var c=a.remoteStreams[b.id],d=Erizo.StreamEvent({type:"stream-attributes-update",attrs:b.attrs,stream:c});c.updateLocalAttributes(b.attrs);c.dispatchEvent(d)});a.socket.on("onRemoveStream",function(b){var c=a.localStreams[b.id];c&&!c.failed?
(c.failed=!0,L.Logger.warning("We received a removeStream from our own stream -- probably erizoJS timed out"),b=Erizo.StreamEvent({type:"stream-failed",msg:"Publishing local stream failed because of an Erizo Error",stream:c}),a.dispatchEvent(b),a.unpublish(c)):(c=a.remoteStreams[b.id])&&c.failed?L.Logger.debug("Received onRemoveStream for a stream that we already marked as failed ",b.id):c?(delete a.remoteStreams[b.id],e(c),c=Erizo.StreamEvent({type:"stream-removed",stream:c}),a.dispatchEvent(c)):
L.Logger.debug("Received a removeStream for",b.id,"and it has not been registered here, ignoring.")});a.socket.on("disconnect",function(){L.Logger.info("Socket disconnected, lost connection to ErizoController");if(0!==a.state){L.Logger.error("Unexpected disconnection from ErizoController");var b=Erizo.RoomEvent({type:"room-disconnected",message:"unexpected-disconnection"});a.dispatchEvent(b)}});a.socket.on("connection_failed",function(b){if("publish"===b.type){if(L.Logger.error("ICE Connection Failed on publishing stream",
b.streamId,a.state),0!==a.state&&b.streamId&&(b=a.localStreams[b.streamId])&&!b.failed){b.failed=!0;var c=Erizo.StreamEvent({type:"stream-failed",msg:"Publishing local stream failed ICE Checks",stream:b});a.dispatchEvent(c);a.unpublish(b)}}else L.Logger.error("ICE Connection Failed on subscribe stream",b.streamId),0!==a.state&&b.streamId&&(b=a.remoteStreams[b.streamId])&&!b.failed&&(b.failed=!0,c=Erizo.StreamEvent({type:"stream-failed",msg:"Subscriber failed ICE, cannot reach Licode for media",stream:b}),
a.dispatchEvent(c),a.unsubscribe(b))});a.socket.on("error",function(a){L.Logger.error("Cannot connect to erizo Controller");p&&p("Cannot connect to ErizoController (socket.io error)",a)});k("token",c,d,p)};var k=function(b,c,d,e){a.socket.emit(b,c,function(a,b){"success"===a?d&&d(b):"error"===a?e&&e(b):d&&d(a,b)})};var l=function(b,c,d,e){"signaling_message"==b&&"object"==typeof c&&"offer"==c.msg.type&&c.msg.sdp&&(c.msg.sdp=c.msg.sdp);0!==a.state?a.socket.emit(b,c,d,function(a,b){e&&e(a,b)}):L.Logger.warning("Trying to send a message over a disconnected Socket")};
a.connect=function(){var c=L.Base64.decodeBase64(b.token);0!==a.state&&L.Logger.warning("Room already connected");a.state=1;h(JSON.parse(c),function(c){var d=0,f=[];var e=c.streams||[];a.p2p=c.p2p;var g=c.id;a.iceServers=c.iceServers;a.state=2;b.defaultVideoBW=c.defaultVideoBW;b.defaultAudioBW=c.defaultAudioBW;b.maxVideoBW=c.maxVideoBW;b.maxAudioBW=c.maxAudioBW;for(d in e)if(e.hasOwnProperty(d)){var h=e[d];c=Erizo.Stream({streamID:h.id,local:!1,audio:h.audio,video:h.video,data:h.data,screen:h.screen,
attributes:h.attributes});f.push(c);a.remoteStreams[h.id]=c}a.roomID=g;L.Logger.info("Connected to room "+a.roomID);d=Erizo.RoomEvent({type:"room-connected",streams:f});a.dispatchEvent(d)},function(b){L.Logger.error("Not Connected! Error: "+b);b=Erizo.RoomEvent({type:"room-error",message:b});a.dispatchEvent(b)})};a.disconnect=function(){L.Logger.debug("Disconnection requested");var b=Erizo.RoomEvent({type:"room-disconnected",message:"expected-disconnection"});a.dispatchEvent(b)};a.publish=function(f,
e,p){e=e||{};e.maxVideoBW=e.maxVideoBW||b.defaultVideoBW;e.maxVideoBW>b.maxVideoBW&&(e.maxVideoBW=b.maxVideoBW);void 0===e.minVideoBW&&(e.minVideoBW=0);e.minVideoBW>b.defaultVideoBW&&(e.minVideoBW=b.defaultVideoBW);e.simulcast=e.simulcast||e._simulcast||!1;if(f&&f.local&&!f.failed&&void 0===a.localStreams[f.getID()])if(f.hasAudio()||f.hasVideo()||f.hasScreen())if(void 0!==f.url||void 0!==f.recording){if(f.url){var g="url";var m=f.url}else g="recording",m=f.recording;L.Logger.info("Checking publish options for",
f.getID());f.checkOptions(e);l("publish",{state:g,data:f.hasData(),audio:f.hasAudio(),video:f.hasVideo(),attributes:f.getAttributes(),metadata:e.metadata,createOffer:e.createOffer},m,function(b,e){null!==b?(L.Logger.info("Stream published"),f.getID=function(){return b},f.sendData=function(a){d(f,a)},f.setAttributes=function(a){c(f,a)},a.localStreams[b]=f,f.room=a,p&&p(b)):(L.Logger.error("Error when publishing stream",e),p&&p(void 0,e))})}else a.p2p?(b.maxAudioBW=e.maxAudioBW,b.maxVideoBW=e.maxVideoBW,
l("publish",{state:"p2p",data:f.hasData(),audio:f.hasAudio(),video:f.hasVideo(),screen:f.hasScreen(),metadata:e.metadata,attributes:f.getAttributes()},void 0,function(b,e){null===b&&(L.Logger.error("Error when publishing the stream",e),p&&p(void 0,e));L.Logger.info("Stream published");f.getID=function(){return b};f.hasData()&&(f.sendData=function(a){d(f,a)});f.setAttributes=function(a){c(f,a)};a.localStreams[b]=f;f.room=a})):(L.Logger.info("Publishing to Erizo Normally, is createOffer",e.createOffer),
l("publish",{state:"erizo",data:f.hasData(),audio:f.hasAudio(),video:f.hasVideo(),screen:f.hasScreen(),minVideoBW:e.minVideoBW,attributes:f.getAttributes(),createOffer:e.createOffer,metadata:e.metadata,scheme:e.scheme},void 0,function(g,n){null===g?(L.Logger.error("Error when publishing the stream: ",n),p&&p(void 0,n)):(L.Logger.info("Stream assigned an Id, starting the publish process"),f.getID=function(){return g},f.hasData()&&(f.sendData=function(a){d(f,a)}),f.setAttributes=function(a){c(f,a)},
a.localStreams[g]=f,f.room=a,f.pc=Erizo.Connection({callback:function(a){L.Logger.debug("Sending message",a);l("signaling_message",{streamId:f.getID(),msg:a},void 0,function(){})},iceServers:a.iceServers,maxAudioBW:e.maxAudioBW,maxVideoBW:e.maxVideoBW,limitMaxAudioBW:b.maxAudioBW,limitMaxVideoBW:b.maxVideoBW,simulcast:e.simulcast,audio:f.hasAudio(),video:f.hasVideo()}),f.pc.addStream(f.stream),f.pc.oniceconnectionstatechange=function(b){"failed"===b&&0!==a.state&&f&&!f.failed&&(f.failed=!0,L.Logger.warning("Publishing Stream",
f.getID(),"has failed after successful ICE checks"),b=Erizo.StreamEvent({type:"stream-failed",msg:"Publishing stream failed after connection",stream:f}),a.dispatchEvent(b),a.unpublish(f))},e.createOffer||f.pc.createOffer(),p&&p(g))}));else f.hasData()&&l("publish",{state:"data",data:f.hasData(),audio:!1,video:!1,screen:!1,metadata:e.metadata,attributes:f.getAttributes()},void 0,function(b,e){null===b?(L.Logger.error("Error publishing stream ",e),p&&p(void 0,e)):(L.Logger.info("Stream published"),
f.getID=function(){return b},f.sendData=function(a){d(f,a)},f.setAttributes=function(a){c(f,a)},a.localStreams[b]=f,f.room=a,p&&p(b))});else L.Logger.error("Trying to publish invalid stream"),p&&p(void 0,"Invalid Stream")};a.startRecording=function(a,b){a?(L.Logger.debug("Start Recording stream: "+a.getID()),k("startRecorder",{to:a.getID()},function(a,c){a&&a.id?(L.Logger.info("Start recording",a.id),b&&b(a.id,void 0,a.timestamp)):(L.Logger.error("Error on start recording",c),b&&b(void 0,c,void 0))})):
(L.Logger.error("Trying to start recording on an invalid stream",a),b&&b(void 0,"Invalid Stream"))};a.stopRecording=function(a,b){k("stopRecorder",{id:a},function(c,d){null===c?(L.Logger.error("Error on stop recording",d),b&&b(void 0,d)):(L.Logger.info("Stop recording",a),b&&b(!0))})};a.unpublish=function(b,c){if(b&&b.local){k("unpublish",b.getID(),function(a,d){null===a?(L.Logger.error("Error unpublishing stream",d),c&&c(void 0,d)):(b.failed&&delete b.failed,L.Logger.info("Stream unpublished"),c&&
c(!0))});var d=b.room&&b.room.p2p;b.room=void 0;if((b.hasAudio()||b.hasVideo()||b.hasScreen())&&void 0===b.url)if(d)for(var e in b.pc)b.pc[e].close(),b.pc[e]=void 0;else b.pc&&b.pc.close(),b.pc=void 0;delete a.localStreams[b.getID()];b.getID=function(){};b.sendData=function(){};b.setAttributes=function(){}}else L.Logger.error(),c&&c(void 0,"Cannot unpublish, stream does not exist or is not local")};a.sendControlMessage=function(a,b,c){a&&a.getID()&&(b={type:"control",action:c},l("signaling_message",
{streamId:a.getID(),msg:b}))};a.subscribe=function(c,d,e){d=d||{};if(!c||c.local||c.failed){var f="Error on subscribe";c?c.local?(L.Logger.warning("Cannot subscribe to local stream, you should subscribe to the remote version of your local stream"),f="Local copy of stream"):c.failed&&(L.Logger.warning("Cannot subscribe to failed stream, you should wait a new stream-added event."),f="Failed stream"):(L.Logger.warning("Cannot subscribe to invalid stream",c),f="Invalid or undefined stream");e&&e(void 0,
f)}else{if(c.hasVideo()||c.hasAudio()||c.hasScreen())c.hasVideo()||c.hasScreen()||(d.video=!1),c.hasAudio()||(d.audio=!1),a.p2p?(l("subscribe",{streamId:c.getID(),metadata:d.metadata}),e&&e(!0)):(d.maxVideoBW=d.maxVideoBW||b.defaultVideoBW,d.maxVideoBW>b.maxVideoBW&&(d.maxVideoBW=b.maxVideoBW),L.Logger.info("Checking subscribe options for",c.getID()),c.checkOptions(d),l("subscribe",{streamId:c.getID(),audio:d.audio,video:d.video,data:d.data,browser:Erizo.getBrowser(),createOffer:d.createOffer,metadata:d.metadata,
slideShowMode:d.slideShowMode},void 0,function(f,g){null===f?(L.Logger.error("Error subscribing to stream ",g),e&&e(void 0,g)):(L.Logger.info("Subscriber added"),c.pc=Erizo.Connection({callback:function(a){L.Logger.info("Sending message",a);l("signaling_message",{streamId:c.getID(),msg:a,browser:c.pc.browser},void 0,function(){})},nop2p:!0,audio:d.audio,video:d.video,maxAudioBW:b.maxAudioBW,maxVideoBW:b.maxVideoBW,limitMaxAudioBW:b.maxAudioBW,limitMaxVideoBW:b.maxVideoBW,iceServers:a.iceServers}),
c.pc.onaddstream=function(b){L.Logger.info("Stream subscribed");c.stream=b.stream;b=Erizo.StreamEvent({type:"stream-subscribed",stream:c});a.dispatchEvent(b)},c.pc.oniceconnectionstatechange=function(b){"failed"===b&&0!==a.state&&c&&!c.failed&&(c.failed=!0,L.Logger.warning("Subscribing stream",c.getID(),"has failed after successful ICE checks"),b=Erizo.StreamEvent({type:"stream-failed",msg:"Subscribing stream failed after connection",stream:c}),a.dispatchEvent(b),a.unsubscribe(c))},c.pc.createOffer(!0),
e&&e(!0))}));else if(c.hasData()&&!1!==d.data)l("subscribe",{streamId:c.getID(),data:d.data,metadata:d.metadata},void 0,function(b,d){null===b?(L.Logger.error("Error subscribing to stream ",d),e&&e(void 0,d)):(L.Logger.info("Stream subscribed"),b=Erizo.StreamEvent({type:"stream-subscribed",stream:c}),a.dispatchEvent(b),e&&e(!0))});else{L.Logger.warning("There's nothing to subscribe to");e&&e(void 0,"Nothing to subscribe to");return}L.Logger.info("Subscribing to: "+c.getID())}};a.unsubscribe=function(b,
c){void 0!==a.socket&&b&&!b.local&&k("unsubscribe",b.getID(),function(a,d){null===a?c&&c(void 0,d):(e(b),c&&c(!0))},function(){L.Logger.error("Error calling unsubscribe.")})};a.getStreamStats=function(b,c){if(!a.socket)return"Error getting stats - no socket";if(!b)return"Error getting stats - no stream";k("getStreamStats",b.getID(),function(a){a&&c(a)})};a.getStreamsByAttribute=function(b,c){var d=[],e;for(e in a.remoteStreams)if(a.remoteStreams.hasOwnProperty(e)){var f=a.remoteStreams[e];void 0!==
f.getAttributes()&&void 0!==f.getAttributes()[b]&&f.getAttributes()[b]===c&&d.push(f)}return d};return a};var L=L||{};
L.Logger=function(b){var a="";var e=function(a){console.log.apply(console,a)};return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,enableLogPanel:function(){b.Logger.panel=document.createElement("textarea");b.Logger.panel.setAttribute("id","licode-logs");b.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none");b.Logger.panel.setAttribute("rows",20);b.Logger.panel.setAttribute("cols",20);b.Logger.panel.setAttribute("readOnly",!0);document.body.appendChild(b.Logger.panel)},setLogLevel:function(a){a>
b.Logger.NONE?a=b.Logger.NONE:a<b.Logger.DEBUG&&(a=b.Logger.DEBUG);b.Logger.logLevel=a},setOutputFunction:function(a){e=a},setLogPrefix:function(b){a=b},log:function(d){var c=a;if(!(d<b.Logger.logLevel)){d===b.Logger.DEBUG?c+="DEBUG":d===b.Logger.TRACE?c+="TRACE":d===b.Logger.INFO?c+="INFO":d===b.Logger.WARNING?c+="WARNING":d===b.Logger.ERROR&&(c+="ERROR");for(var c=c+": ",h=[],k=0;k<arguments.length;k++)h[k]=arguments[k];h=h.slice(1);h=[c].concat(h);if(void 0!==b.Logger.panel){c="";for(k=0;k<h.length;k++)c+=
h[k];b.Logger.panel.value=b.Logger.panel.value+"\n"+c}else e.apply(b.Logger,[h])}},debug:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.log.apply(b.Logger,[b.Logger.DEBUG].concat(a))},trace:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.log.apply(b.Logger,[b.Logger.TRACE].concat(a))},info:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.log.apply(b.Logger,[b.Logger.INFO].concat(a))},warning:function(){for(var a=
[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.log.apply(b.Logger,[b.Logger.WARNING].concat(a))},error:function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];b.Logger.log.apply(b.Logger,[b.Logger.ERROR].concat(a))}}}(L);L=L||{};
L.Base64=function(){var b,a,e;var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");var c=[];for(e=0;e<d.length;e+=1)c[d[e]]=e;var h=function(c){b=c;a=0};var k=function(){if(!b||a>=b.length)return-1;var c=b.charCodeAt(a)&255;a+=1;return c};var l=function(){if(!b)return-1;for(;;){if(a>=b.length)return-1;var d=b.charAt(a);a+=1;if(c[d])return c[d];if("A"===d)return 0}};var f=function(a){a=a.toString(16);1===a.length&&(a="0"+a);return unescape("%"+a)};return{encodeBase64:function(a){var b;h(a);
a="";var c=Array(3);var e=0;for(b=!1;!b&&-1!==(c[0]=k());)c[1]=k(),c[2]=k(),a+=d[c[0]>>2],-1!==c[1]?(a+=d[c[0]<<4&48|c[1]>>4],-1!==c[2]?(a+=d[c[1]<<2&60|c[2]>>6],a+=d[c[2]&63]):(a+=d[c[1]<<2&60],a+="\x3d",b=!0)):(a+=d[c[0]<<4&48],a+="\x3d",a+="\x3d",b=!0),e+=4,76<=e&&(a+="\n",e=0);return a},decodeBase64:function(a){var b;h(a);a="";var c=Array(4);for(b=!1;!b&&-1!==(c[0]=l())&&-1!==(c[1]=l());)c[2]=l(),c[3]=l(),a+=f(c[0]<<2&255|c[1]>>4),-1!==c[2]?(a+=f(c[1]<<4&255|c[2]>>2),-1!==c[3]?a+=f(c[2]<<6&255|
c[3]):b=!0):b=!0;return a}}}(L);/*
 https://github.com/Mr0grog/element-query/blob/master/LICENSE

 @param element
 @param value
 @param units
 @returns {*}
*/
(function(){function b(){(new e.ElementQueries).init()}function a(a,b){var c=Object.prototype.toString.call(a),d=0,e=a.length;if("[object Array]"===c||"[object NodeList]"===c||"[object HTMLCollection]"===c||"undefined"!==typeof jQuery&&a instanceof jQuery||"undefined"!==typeof Elements&&a instanceof Elements)for(;d<e;d++)b(a[d]);else b(a)}var e=this.L=this.L||{};e.ElementQueries=function(){function a(a){a||(a=document.documentElement);a=getComputedStyle(a,"fontSize");return parseFloat(a)||16}function b(b,
c){var d=c.replace(/[0-9]*/,"");c=parseFloat(c);switch(d){case "px":return c;case "em":return c*a(b);case "rem":return c*a();case "vw":return c*document.documentElement.clientWidth/100;case "vh":return c*document.documentElement.clientHeight/100;case "vmin":case "vmax":return c*(0,Math["vmin"===d?"min":"max"])(document.documentElement.clientWidth/100,document.documentElement.clientHeight/100);default:return c}}function d(a){this.element=a;this.options=[];var c,d,e,f=0,g=0,n,h,k,l,p;this.addOption=
function(a){this.options.push(a)};var u=["min-width","min-height","max-width","max-height"];this.call=function(){f=this.element.offsetWidth;g=this.element.offsetHeight;k={};c=0;for(d=this.options.length;c<d;c++)e=this.options[c],n=b(this.element,e.value),h="width"===e.property?f:g,p=e.mode+"-"+e.property,l="","min"===e.mode&&h>=n&&(l+=e.value),"max"===e.mode&&h<=n&&(l+=e.value),k[p]||(k[p]=""),l&&-1===(" "+k[p]+" ").indexOf(" "+l+" ")&&(k[p]+=" "+l);for(var a in u)k[u[a]]?this.element.setAttribute(u[a],
k[u[a]].substr(1)):this.element.removeAttribute(u[a])}}function l(a,b){a.elementQueriesSetupInformation?a.elementQueriesSetupInformation.addOption(b):(a.elementQueriesSetupInformation=new d(a),a.elementQueriesSetupInformation.addOption(b),new e.ResizeSensor(a,function(){a.elementQueriesSetupInformation.call()}));a.elementQueriesSetupInformation.call()}function f(a){var b;for(a=a.replace(/'/g,'"');null!==(b=p.exec(a));)if(5<b.length){var c=void 0,d=b[1]||b[5],e=b[2],f=b[3];b=b[4];document.querySelectorAll&&
(c=document.querySelectorAll.bind(document));c||"undefined"===typeof $$||(c=$$);c||"undefined"===typeof jQuery||(c=jQuery);if(!c)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";for(var c=c(d),d=0,g=c.length;d<g;d++)l(c[d],{mode:e,property:f,value:b})}}function g(a){if(a)if("string"===typeof a)a=a.toLowerCase(),-1===a.indexOf("min-width")&&-1===a.indexOf("max-width")||f(a);else for(var b=0,c=a.length;b<c;b++)if(1===a[b].type){var d=a[b].selectorText||a[b].cssText;-1!==d.indexOf("min-height")||
-1!==d.indexOf("max-height")?f(d):-1===d.indexOf("min-width")&&-1===d.indexOf("max-width")||f(d)}else 4===a[b].type&&g(a[b].cssRules||a[b].rules)}var p=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/mgi;this.init=function(){for(var a=0,b=document.styleSheets.length;a<b;a++)g(document.styleSheets[a].cssText||document.styleSheets[a].cssRules||document.styleSheets[a].rules)}};window.addEventListener?window.addEventListener("load",b,!1):window.attachEvent("onload",
b);var d=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)};e.ResizeSensor=function(b,h){function c(){var a=[];this.add=function(b){a.push(b)};var b,c;this.call=function(){b=0;for(c=a.length;b<c;b++)a[b].call()};this.remove=function(d){var e=[];b=0;for(c=a.length;b<c;b++)a[b]!==d&&e.push(a[b]);a=e};this.length=function(){return a.length}}function l(a,b){return a.currentStyle?a.currentStyle[b]:window.getComputedStyle?
window.getComputedStyle(a,null).getPropertyValue(b):a.style[b]}function f(a,b){if(!a.resizedAttached)a.resizedAttached=new c,a.resizedAttached.add(b);else if(a.resizedAttached){a.resizedAttached.add(b);return}a.resizeSensor=document.createElement("div");a.resizeSensor.className="resize-sensor";a.resizeSensor.style.cssText="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;";a.resizeSensor.innerHTML='\x3cdiv class\x3d"resize-sensor-expand" style\x3d"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"\x3e\x3cdiv style\x3d"position: absolute; left: 0; top: 0; transition: 0s;"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"resize-sensor-shrink" style\x3d"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"\x3e\x3cdiv style\x3d"position: absolute; left: 0; top: 0; transition: 0s; width: 200%; height: 200%"\x3e\x3c/div\x3e\x3c/div\x3e';
a.appendChild(a.resizeSensor);"static"===l(a,"position")&&(a.style.position="relative");var e=a.resizeSensor.childNodes[0],f=e.childNodes[0],g=a.resizeSensor.childNodes[1],h=function(){f.style.width="100000px";f.style.height="100000px";e.scrollLeft=1E5;e.scrollTop=1E5;g.scrollLeft=1E5;g.scrollTop=1E5};h();var k=!1,p=function(){a.resizedAttached&&(k&&(a.resizedAttached.call(),k=!1),d(p))};d(p);var G,v,r,t;b=function(){if((r=a.offsetWidth)!==G||(t=a.offsetHeight)!==v)k=!0,G=r,v=t;h()};var B=function(a,
b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c)};B(e,"scroll",b);B(g,"scroll",b)}a(b,function(a){f(a,h)});this.detach=function(a){e.ResizeSensor.detach(b,a)}};e.ResizeSensor.detach=function(b,d){a(b,function(a){if(a.resizedAttached&&"function"===typeof d&&(a.resizedAttached.remove(d),a.resizedAttached.length()))return;a.resizeSensor&&(a.contains(a.resizeSensor)&&a.removeChild(a.resizeSensor),delete a.resizeSensor,delete a.resizedAttached)})}})();Erizo=Erizo||{};Erizo.View=function(){var b=Erizo.EventDispatcher({});b.url="";return b};Erizo=Erizo||{};
Erizo.VideoPlayer=function(b){var a=Erizo.View({});a.id=b.id;a.stream=b.stream.stream;a.elementID=b.elementID;var e=function(){a.bar.display()};var d=function(){a.bar.hide()};a.destroy=function(){a.video.pause();delete a.resizer;a.parentNode.removeChild(a.div)};a.resize=function(){var c=a.container.offsetWidth,d=a.container.offsetHeight;if(b.stream.screen||!1===b.options.crop)9/16*c<d?(a.video.style.width=c+"px",a.video.style.height=9/16*c+"px",a.video.style.top=-(9/16*c/2-d/2)+"px",a.video.style.left=
"0px"):(a.video.style.height=d+"px",a.video.style.width=16/9*d+"px",a.video.style.left=-(16/9*d/2-c/2)+"px",a.video.style.top="0px");else if(c!==a.containerWidth||d!==a.containerHeight)3/4*c>d?(a.video.style.width=c+"px",a.video.style.height=3/4*c+"px",a.video.style.top=-(3/4*c/2-d/2)+"px",a.video.style.left="0px"):(a.video.style.height=d+"px",a.video.style.width=4/3*d+"px",a.video.style.left=-(4/3*d/2-c/2)+"px",a.video.style.top="0px");a.containerWidth=c;a.containerHeight=d};L.Logger.debug("Creating URL from stream "+
a.stream);a.streamUrl=(window.URL||webkitURL).createObjectURL(a.stream);a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("class","licode_player");a.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;");!1!==b.options.loader&&(a.loader=document.createElement("img"),a.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px"),
a.loader.setAttribute("id","back_"+a.id),a.loader.setAttribute("class","licode_loader"),a.loader.setAttribute("src",a.url+"/assets/loader.gif"));a.video=document.createElement("video");a.video.setAttribute("id","stream"+a.id);a.video.setAttribute("class","licode_stream");a.video.setAttribute("style","width: 100%; height: 100%; position: absolute");a.video.setAttribute("autoplay","autoplay");b.stream.local&&(a.video.volume=0);a.container=void 0!==a.elementID?"object"===typeof a.elementID&&"function"===
typeof a.elementID.appendChild?a.elementID:document.getElementById(a.elementID):document.body;a.container.appendChild(a.div);a.parentNode=a.div.parentNode;a.loader&&a.div.appendChild(a.loader);a.div.appendChild(a.video);a.containerWidth=0;a.containerHeight=0;!1!==b.options.resizer&&(a.resizer=new L.ResizeSensor(a.container,a.resize),a.resize());!1!==b.options.bar?(a.bar=new Erizo.Bar({elementID:"player_"+a.id,id:a.id,stream:b.stream,media:a.video,options:b.options}),a.div.onmouseover=e,a.div.onmouseout=
d):a.media=a.video;a.video.src=a.streamUrl;return a};Erizo=Erizo||{};
Erizo.AudioPlayer=function(b){var a=Erizo.View({});a.id=b.id;a.stream=b.stream.stream;a.elementID=b.elementID;L.Logger.debug("Creating URL from stream "+a.stream);a.streamUrl=(window.URL||webkitURL).createObjectURL(a.stream);a.audio=document.createElement("audio");a.audio.setAttribute("id","stream"+a.id);a.audio.setAttribute("class","licode_stream");a.audio.setAttribute("style","width: 100%; height: 100%; position: absolute");a.audio.setAttribute("autoplay","autoplay");b.stream.local&&(a.audio.volume=
0);b.stream.local&&(a.audio.volume=0);if(void 0!==a.elementID){a.destroy=function(){a.audio.pause();a.parentNode.removeChild(a.div)};var e=function(){a.bar.display()};var d=function(){a.bar.hide()};a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("class","licode_player");a.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;");a.container="object"===typeof a.elementID&&"function"===typeof a.elementID.appendChild?a.elementID:
document.getElementById(a.elementID);a.container.appendChild(a.div);a.parentNode=a.div.parentNode;a.div.appendChild(a.audio);!1!==b.options.bar?(a.bar=new Erizo.Bar({elementID:"player_"+a.id,id:a.id,stream:b.stream,media:a.audio,options:b.options}),a.div.onmouseover=e,a.div.onmouseout=d):a.media=a.audio}else a.destroy=function(){a.audio.pause();a.parentNode.removeChild(a.audio)},document.body.appendChild(a.audio),a.parentNode=document.body;a.audio.src=a.streamUrl;return a};Erizo=Erizo||{};
Erizo.Bar=function(b){var a=Erizo.View({}),e;a.elementID=b.elementID;a.id=b.id;a.div=document.createElement("div");a.div.setAttribute("id","bar_"+a.id);a.div.setAttribute("class","licode_bar");a.bar=document.createElement("div");a.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)");a.bar.setAttribute("id","subbar_"+a.id);a.bar.setAttribute("class","licode_subbar");a.link=document.createElement("a");a.link.setAttribute("href",
"http://www.lynckia.com/");a.link.setAttribute("class","licode_link");a.link.setAttribute("target","_blank");a.logo=document.createElement("img");a.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;");a.logo.setAttribute("class","licode_logo");a.logo.setAttribute("alt","Lynckia");a.logo.setAttribute("src",a.url+"/assets/star.svg");var d=function(b){"block"!==b?b="none":clearTimeout(e);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+
b)};a.display=function(){d("block")};a.hide=function(){e=setTimeout(d,1E3)};document.getElementById(a.elementID).appendChild(a.div);a.div.appendChild(a.bar);a.bar.appendChild(a.link);a.link.appendChild(a.logo);b.stream.screen||void 0!==b.options&&void 0!==b.options.speaker&&!0!==b.options.speaker||(a.speaker=new Erizo.Speaker({elementID:"subbar_"+a.id,id:a.id,stream:b.stream,media:b.media}));a.display();a.hide();return a};Erizo=Erizo||{};
Erizo.Speaker=function(b){var a=Erizo.View({}),e=50;a.elementID=b.elementID;a.media=b.media;a.id=b.id;a.stream=b.stream;a.div=document.createElement("div");a.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;");a.icon=document.createElement("img");a.icon.setAttribute("id","volume_"+a.id);a.icon.setAttribute("src",a.url+"/assets/sound48.png");a.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;");a.div.appendChild(a.icon);if(a.stream.local){var d=
function(){a.media.muted=!0;a.icon.setAttribute("src",a.url+"/assets/mute48.png");a.stream.stream.getAudioTracks()[0].enabled=!1};var c=function(){a.media.muted=!1;a.icon.setAttribute("src",a.url+"/assets/sound48.png");a.stream.stream.getAudioTracks()[0].enabled=!0};a.icon.onclick=function(){a.media.muted?c():d()}}else{a.picker=document.createElement("input");a.picker.setAttribute("id","picker_"+a.id);a.picker.type="range";a.picker.min=0;a.picker.max=100;a.picker.step=10;a.picker.value=e;a.picker.setAttribute("orient",
"vertical");a.div.appendChild(a.picker);a.media.volume=a.picker.value/100;a.media.muted=!1;a.picker.oninput=function(){0<a.picker.value?(a.media.muted=!1,a.icon.setAttribute("src",a.url+"/assets/sound48.png")):(a.media.muted=!0,a.icon.setAttribute("src",a.url+"/assets/mute48.png"));a.media.volume=a.picker.value/100};var h=function(b){a.picker.setAttribute("style","background: transparent; width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+a.div.offsetHeight+"px; right: 0px; -webkit-appearance: slider-vertical; display: "+
b)};d=function(){a.icon.setAttribute("src",a.url+"/assets/mute48.png");e=a.picker.value;a.picker.value=0;a.media.volume=0;a.media.muted=!0};c=function(){a.icon.setAttribute("src",a.url+"/assets/sound48.png");a.picker.value=e;a.media.volume=a.picker.value/100;a.media.muted=!1};a.icon.onclick=function(){a.media.muted?c():d()};a.div.onmouseover=function(){h("block")};a.div.onmouseout=function(){h("none")};h("none")}document.getElementById(a.elementID).appendChild(a.div);return a};
